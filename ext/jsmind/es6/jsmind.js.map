{"version":3,"file":"jsmind.js","sources":["../src/jsmind.common.js","../src/jsmind.dom.js","../src/jsmind.util.js","../src/jsmind.option.js","../src/jsmind.node.js","../src/jsmind.mind.js","../src/jsmind.format.js","../src/jsmind.data_provider.js","../src/jsmind.layout_provider.js","../src/jsmind.graph.js","../src/jsmind.view_provider.js","../src/jsmind.shortcut_provider.js","../src/jsmind.plugin.js","../src/jsmind.js"],"sourcesContent":["/**\r\n * @license BSD\r\n * @copyright 2014-2023 hizzgdev@163.com\r\n *\r\n * Project Home:\r\n *   https://github.com/hizzgdev/jsmind/\r\n */\r\n\r\nexport const __version__ = '0.8.5';\r\nexport const __author__ = 'hizzgdev@163.com';\r\n\r\nif (typeof String.prototype.startsWith != 'function') {\r\n    String.prototype.startsWith = function (p) {\r\n        return this.slice(0, p.length) === p;\r\n    };\r\n}\r\n\r\nexport const Direction = {\r\n    left: -1,\r\n    center: 0,\r\n    right: 1,\r\n    of: function (dir) {\r\n        if (!dir || dir === -1 || dir === 0 || dir === 1) {\r\n            return dir;\r\n        }\r\n        if (dir === '-1' || dir === '0' || dir === '1') {\r\n            return parseInt(dir);\r\n        }\r\n        if (dir.toLowerCase() === 'left') {\r\n            return this.left;\r\n        }\r\n        if (dir.toLowerCase() === 'right') {\r\n            return this.right;\r\n        }\r\n        if (dir.toLowerCase() === 'center') {\r\n            return this.center;\r\n        }\r\n    },\r\n};\r\nexport const EventType = { show: 1, resize: 2, edit: 3, select: 4 };\r\nexport const Key = { meta: 1 << 13, ctrl: 1 << 12, alt: 1 << 11, shift: 1 << 10 };\r\nexport const LogLevel = { debug: 1, info: 2, warn: 3, error: 4, disable: 9 };\r\n\r\n// an noop function define\r\nvar _noop = function () {};\r\nexport let logger =\r\n    typeof console === 'undefined'\r\n        ? {\r\n              level: _noop,\r\n              log: _noop,\r\n              debug: _noop,\r\n              info: _noop,\r\n              warn: _noop,\r\n              error: _noop,\r\n          }\r\n        : {\r\n              level: setup_logger_level,\r\n              log: console.log,\r\n              debug: console.debug,\r\n              info: console.info,\r\n              warn: console.warn,\r\n              error: console.error,\r\n          };\r\n\r\nfunction setup_logger_level(log_level) {\r\n    if (log_level > LogLevel.debug) {\r\n        logger.debug = _noop;\r\n    } else {\r\n        logger.debug = console.debug;\r\n    }\r\n    if (log_level > LogLevel.info) {\r\n        logger.info = _noop;\r\n    } else {\r\n        logger.info = console.info;\r\n    }\r\n    if (log_level > LogLevel.warn) {\r\n        logger.warn = _noop;\r\n    } else {\r\n        logger.warn = console.warn;\r\n    }\r\n    if (log_level > LogLevel.error) {\r\n        logger.error = _noop;\r\n    } else {\r\n        logger.error = console.error;\r\n    }\r\n}\r\n","/**\r\n * @license BSD\r\n * @copyright 2014-2023 hizzgdev@163.com\r\n *\r\n * Project Home:\r\n *   https://github.com/hizzgdev/jsmind/\r\n */\r\n\r\nclass Dom {\r\n    constructor(w) {\r\n        this.w = w;\r\n        this.d = w.document;\r\n        this.g = function (id) {\r\n            return this.d.getElementById(id);\r\n        };\r\n        this.c = function (tag) {\r\n            return this.d.createElement(tag);\r\n        };\r\n        this.t = function (n, t) {\r\n            if (n.hasChildNodes()) {\r\n                n.firstChild.nodeValue = t;\r\n            } else {\r\n                n.appendChild(this.d.createTextNode(t));\r\n            }\r\n        };\r\n\r\n        this.h = function (n, t) {\r\n            if (t instanceof HTMLElement) {\r\n                n.innerHTML = '';\r\n                n.appendChild(t);\r\n            } else {\r\n                n.innerHTML = t;\r\n            }\r\n        };\r\n        // detect isElement\r\n        this.i = function (el) {\r\n            return (\r\n                !!el &&\r\n                typeof el === 'object' &&\r\n                el.nodeType === 1 &&\r\n                typeof el.style === 'object' &&\r\n                typeof el.ownerDocument === 'object'\r\n            );\r\n        };\r\n\r\n        //target,eventType,handler\r\n        this.on = function (t, e, h) {\r\n            if (!!t.addEventListener) {\r\n                t.addEventListener(e, h, false);\r\n            } else {\r\n                t.attachEvent('on' + e, h);\r\n            }\r\n        };\r\n    }\r\n}\r\n\r\nexport const $ = new Dom(window);\r\n","/**\r\n * @license BSD\r\n * @copyright 2014-2023 hizzgdev@163.com\r\n *\r\n * Project Home:\r\n *   https://github.com/hizzgdev/jsmind/\r\n */\r\n\r\nimport { $ } from './jsmind.dom.js';\r\n\r\nexport const util = {\r\n    file: {\r\n        read: function (file_data, fn_callback) {\r\n            var reader = new FileReader();\r\n            reader.onload = function () {\r\n                if (typeof fn_callback === 'function') {\r\n                    fn_callback(this.result, file_data.name);\r\n                }\r\n            };\r\n            reader.readAsText(file_data);\r\n        },\r\n\r\n        save: function (file_data, type, name) {\r\n            var blob;\r\n            if (typeof $.w.Blob === 'function') {\r\n                blob = new Blob([file_data], { type: type });\r\n            } else {\r\n                var BlobBuilder =\r\n                    $.w.BlobBuilder ||\r\n                    $.w.MozBlobBuilder ||\r\n                    $.w.WebKitBlobBuilder ||\r\n                    $.w.MSBlobBuilder;\r\n                var bb = new BlobBuilder();\r\n                bb.append(file_data);\r\n                blob = bb.getBlob(type);\r\n            }\r\n            if (navigator.msSaveBlob) {\r\n                navigator.msSaveBlob(blob, name);\r\n            } else {\r\n                var URL = $.w.URL || $.w.webkitURL;\r\n                var blob_url = URL.createObjectURL(blob);\r\n                var anchor = $.c('a');\r\n                if ('download' in anchor) {\r\n                    anchor.style.visibility = 'hidden';\r\n                    anchor.href = blob_url;\r\n                    anchor.download = name;\r\n                    $.d.body.appendChild(anchor);\r\n                    var evt = $.d.createEvent('MouseEvents');\r\n                    evt.initEvent('click', true, true);\r\n                    anchor.dispatchEvent(evt);\r\n                    $.d.body.removeChild(anchor);\r\n                } else {\r\n                    location.href = blob_url;\r\n                }\r\n            }\r\n        },\r\n    },\r\n\r\n    json: {\r\n        json2string: function (json) {\r\n            return JSON.stringify(json);\r\n        },\r\n        string2json: function (json_str) {\r\n            return JSON.parse(json_str);\r\n        },\r\n        merge: function (b, a) {\r\n            for (var o in a) {\r\n                if (o in b) {\r\n                    if (\r\n                        typeof b[o] === 'object' &&\r\n                        Object.prototype.toString.call(b[o]).toLowerCase() == '[object object]' &&\r\n                        !b[o].length\r\n                    ) {\r\n                        util.json.merge(b[o], a[o]);\r\n                    } else {\r\n                        b[o] = a[o];\r\n                    }\r\n                } else {\r\n                    b[o] = a[o];\r\n                }\r\n            }\r\n            return b;\r\n        },\r\n    },\r\n\r\n    uuid: {\r\n        newid: function () {\r\n            return (\r\n                new Date().getTime().toString(16) + Math.random().toString(16).substring(2)\r\n            ).substring(2, 18);\r\n        },\r\n    },\r\n\r\n    text: {\r\n        is_empty: function (s) {\r\n            if (!s) {\r\n                return true;\r\n            }\r\n            return s.replace(/\\s*/, '').length == 0;\r\n        },\r\n    },\r\n};\r\n","/**\r\n * @license BSD\r\n * @copyright 2014-2023 hizzgdev@163.com\r\n *\r\n * Project Home:\r\n *   https://github.com/hizzgdev/jsmind/\r\n */\r\n\r\nimport { util } from './jsmind.util.js';\r\n\r\nconst default_options = {\r\n    container: '', // id of the container\r\n    editable: false, // you can change it in your options\r\n    theme: null,\r\n    mode: 'full', // full or side\r\n    support_html: true,\r\n    log_level: 'info',\r\n\r\n    view: {\r\n        engine: 'canvas',\r\n        enable_device_pixel_ratio: false,\r\n        hmargin: 100,\r\n        vmargin: 50,\r\n        line_width: 2,\r\n        line_color: '#555',\r\n        line_style: 'curved', // [straight | curved]\r\n        draggable: false, // drag the mind map with your mouse, when it's larger that the container\r\n        hide_scrollbars_when_draggable: false, // hide container scrollbars, when mind map is larger than container and draggable option is true.\r\n        node_overflow: 'hidden', // [hidden | wrap]\r\n        zoom: {\r\n            min: 0.5,\r\n            max: 2.1,\r\n            step: 0.1,\r\n        },\r\n        custom_node_render: null,\r\n        expander_style: 'char', // [char | number]\r\n    },\r\n    layout: {\r\n        hspace: 30,\r\n        vspace: 20,\r\n        pspace: 13,\r\n        cousin_space: 0,\r\n    },\r\n    default_event_handle: {\r\n        enable_mousedown_handle: true,\r\n        enable_click_handle: true,\r\n        enable_dblclick_handle: true,\r\n        enable_mousewheel_handle: true,\r\n    },\r\n    shortcut: {\r\n        enable: true,\r\n        handles: {},\r\n        mapping: {\r\n            addchild: [45, 4096 + 13], // Insert, Ctrl+Enter\r\n            addbrother: 13, // Enter\r\n            editnode: 113, // F2\r\n            delnode: 46, // Delete\r\n            toggle: 32, // Space\r\n            left: 37, // Left\r\n            up: 38, // Up\r\n            right: 39, // Right\r\n            down: 40, // Down\r\n        },\r\n    },\r\n    plugin: {},\r\n};\r\n\r\nexport function merge_option(options) {\r\n    var opts = {};\r\n    util.json.merge(opts, default_options);\r\n    util.json.merge(opts, options);\r\n\r\n    if (!opts.container) {\r\n        throw new Error('the options.container should not be null or empty.');\r\n    }\r\n    return opts;\r\n}\r\n","/**\r\n * @license BSD\r\n * @copyright 2014-2023 hizzgdev@163.com\r\n *\r\n * Project Home:\r\n *   https://github.com/hizzgdev/jsmind/\r\n */\r\n\r\nimport { logger } from './jsmind.common.js';\r\nexport class Node {\r\n    constructor(sId, iIndex, sTopic, oData, bIsRoot, oParent, eDirection, bExpanded) {\r\n        if (!sId) {\r\n            logger.error('invalid node id');\r\n            return;\r\n        }\r\n        if (typeof iIndex != 'number') {\r\n            logger.error('invalid node index');\r\n            return;\r\n        }\r\n        if (typeof bExpanded === 'undefined') {\r\n            bExpanded = true;\r\n        }\r\n        this.id = sId;\r\n        this.index = iIndex;\r\n        this.topic = sTopic;\r\n        this.data = oData || {};\r\n        this.isroot = bIsRoot;\r\n        this.parent = oParent;\r\n        this.direction = eDirection;\r\n        this.expanded = !!bExpanded;\r\n        this.children = [];\r\n        this._data = {};\r\n    }\r\n\r\n    get_location() {\r\n        var vd = this._data.view;\r\n        return {\r\n            x: vd.abs_x,\r\n            y: vd.abs_y,\r\n        };\r\n    }\r\n    get_size() {\r\n        var vd = this._data.view;\r\n        return {\r\n            w: vd.width,\r\n            h: vd.height,\r\n        };\r\n    }\r\n\r\n    static compare(node1, node2) {\r\n        // '-1' is always the latest\r\n        var r = 0;\r\n        var i1 = node1.index;\r\n        var i2 = node2.index;\r\n        if (i1 >= 0 && i2 >= 0) {\r\n            r = i1 - i2;\r\n        } else if (i1 == -1 && i2 == -1) {\r\n            r = 0;\r\n        } else if (i1 == -1) {\r\n            r = 1;\r\n        } else if (i2 == -1) {\r\n            r = -1;\r\n        } else {\r\n            r = 0;\r\n        }\r\n        return r;\r\n    }\r\n    static inherited(parent_node, node) {\r\n        if (!!parent_node && !!node) {\r\n            if (parent_node.id === node.id) {\r\n                return true;\r\n            }\r\n            if (parent_node.isroot) {\r\n                return true;\r\n            }\r\n            var pid = parent_node.id;\r\n            var p = node;\r\n            while (!p.isroot) {\r\n                p = p.parent;\r\n                if (p.id === pid) {\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n    static is_node(n) {\r\n        return !!n && n instanceof Node;\r\n    }\r\n}\r\n","/**\r\n * @license BSD\r\n * @copyright 2014-2023 hizzgdev@163.com\r\n *\r\n * Project Home:\r\n *   https://github.com/hizzgdev/jsmind/\r\n */\r\n\r\nimport { Node } from './jsmind.node.js';\r\nimport { logger, Direction } from './jsmind.common.js';\r\n\r\nexport class Mind {\r\n    constructor() {\r\n        this.name = null;\r\n        this.author = null;\r\n        this.version = null;\r\n        this.root = null;\r\n        this.selected = null;\r\n        this.nodes = {};\r\n    }\r\n    get_node(node_id) {\r\n        if (node_id in this.nodes) {\r\n            return this.nodes[node_id];\r\n        } else {\r\n            logger.warn('the node[id=' + node_id + '] can not be found');\r\n            return null;\r\n        }\r\n    }\r\n    set_root(node_id, topic, data) {\r\n        if (this.root == null) {\r\n            this.root = new Node(node_id, 0, topic, data, true);\r\n            this._put_node(this.root);\r\n            return this.root;\r\n        } else {\r\n            logger.error('root node is already exist');\r\n            return null;\r\n        }\r\n    }\r\n    add_node(parent_node, node_id, topic, data, direction, expanded, idx) {\r\n        if (!Node.is_node(parent_node)) {\r\n            logger.error('the parent_node ' + parent_node + ' is not a node.');\r\n            return null;\r\n        }\r\n        var node_index = idx || -1;\r\n        var node = new Node(\r\n            node_id,\r\n            node_index,\r\n            topic,\r\n            data,\r\n            false,\r\n            parent_node,\r\n            parent_node.direction,\r\n            expanded\r\n        );\r\n        if (parent_node.isroot) {\r\n            node.direction = direction || Direction.right;\r\n        }\r\n        if (this._put_node(node)) {\r\n            parent_node.children.push(node);\r\n            this._update_index(parent_node);\r\n        } else {\r\n            logger.error(\"fail, the node id '\" + node.id + \"' has been already exist.\");\r\n            node = null;\r\n        }\r\n        return node;\r\n    }\r\n    insert_node_before(node_before, node_id, topic, data, direction) {\r\n        if (!Node.is_node(node_before)) {\r\n            logger.error('the node_before ' + node_before + ' is not a node.');\r\n            return null;\r\n        }\r\n        var node_index = node_before.index - 0.5;\r\n        return this.add_node(node_before.parent, node_id, topic, data, direction, true, node_index);\r\n    }\r\n    get_node_before(node) {\r\n        if (!Node.is_node(node)) {\r\n            var the_node = this.get_node(node);\r\n            if (!the_node) {\r\n                logger.error('the node[id=' + node + '] can not be found.');\r\n                return null;\r\n            } else {\r\n                return this.get_node_before(the_node);\r\n            }\r\n        }\r\n        if (node.isroot) {\r\n            return null;\r\n        }\r\n        var idx = node.index - 2;\r\n        if (idx >= 0) {\r\n            return node.parent.children[idx];\r\n        } else {\r\n            return null;\r\n        }\r\n    }\r\n    insert_node_after(node_after, node_id, topic, data, direction) {\r\n        if (!Node.is_node(node_after)) {\r\n            logger.error('the node_after ' + node_after + ' is not a node.');\r\n            return null;\r\n        }\r\n        var node_index = node_after.index + 0.5;\r\n        return this.add_node(node_after.parent, node_id, topic, data, direction, true, node_index);\r\n    }\r\n    get_node_after(node) {\r\n        if (!Node.is_node(node)) {\r\n            var the_node = this.get_node(node);\r\n            if (!the_node) {\r\n                logger.error('the node[id=' + node + '] can not be found.');\r\n                return null;\r\n            } else {\r\n                return this.get_node_after(the_node);\r\n            }\r\n        }\r\n        if (node.isroot) {\r\n            return null;\r\n        }\r\n        var idx = node.index;\r\n        var brothers = node.parent.children;\r\n        if (brothers.length > idx) {\r\n            return node.parent.children[idx];\r\n        } else {\r\n            return null;\r\n        }\r\n    }\r\n    move_node(node, before_id, parent_id, direction) {\r\n        if (!Node.is_node(node)) {\r\n            logger.error('the parameter node ' + node + ' is not a node.');\r\n            return null;\r\n        }\r\n        if (!parent_id) {\r\n            parent_id = node.parent.id;\r\n        }\r\n        return this._move_node(node, before_id, parent_id, direction);\r\n    }\r\n    _flow_node_direction(node, direction) {\r\n        if (typeof direction === 'undefined') {\r\n            direction = node.direction;\r\n        } else {\r\n            node.direction = direction;\r\n        }\r\n        var len = node.children.length;\r\n        while (len--) {\r\n            this._flow_node_direction(node.children[len], direction);\r\n        }\r\n    }\r\n    _move_node_internal(node, before_id) {\r\n        if (!!node && !!before_id) {\r\n            if (before_id == '_last_') {\r\n                node.index = -1;\r\n                this._update_index(node.parent);\r\n            } else if (before_id == '_first_') {\r\n                node.index = 0;\r\n                this._update_index(node.parent);\r\n            } else {\r\n                var node_before = !!before_id ? this.get_node(before_id) : null;\r\n                if (\r\n                    node_before != null &&\r\n                    node_before.parent != null &&\r\n                    node_before.parent.id == node.parent.id\r\n                ) {\r\n                    node.index = node_before.index - 0.5;\r\n                    this._update_index(node.parent);\r\n                }\r\n            }\r\n        }\r\n        return node;\r\n    }\r\n    _move_node(node, before_id, parent_id, direction) {\r\n        if (!!node && !!parent_id) {\r\n            var parent_node = this.get_node(parent_id);\r\n            if (Node.inherited(node, parent_node)) {\r\n                logger.error('can not move a node to its children');\r\n                return null;\r\n            }\r\n            if (node.parent.id != parent_id) {\r\n                // remove from parent's children\r\n                var sibling = node.parent.children;\r\n                var si = sibling.length;\r\n                while (si--) {\r\n                    if (sibling[si].id == node.id) {\r\n                        sibling.splice(si, 1);\r\n                        break;\r\n                    }\r\n                }\r\n                let origin_parent = node.parent;\r\n                node.parent = parent_node;\r\n                parent_node.children.push(node);\r\n                this._update_index(origin_parent);\r\n            }\r\n\r\n            if (node.parent.isroot) {\r\n                if (direction == Direction.left) {\r\n                    node.direction = direction;\r\n                } else {\r\n                    node.direction = Direction.right;\r\n                }\r\n            } else {\r\n                node.direction = node.parent.direction;\r\n            }\r\n            this._move_node_internal(node, before_id);\r\n            this._flow_node_direction(node);\r\n        }\r\n        return node;\r\n    }\r\n    remove_node(node) {\r\n        if (!Node.is_node(node)) {\r\n            logger.error('the parameter node ' + node + ' is not a node.');\r\n            return false;\r\n        }\r\n        if (node.isroot) {\r\n            logger.error('fail, can not remove root node');\r\n            return false;\r\n        }\r\n        if (this.selected != null && this.selected.id == node.id) {\r\n            this.selected = null;\r\n        }\r\n        // clean all subordinate nodes\r\n        var children = node.children;\r\n        var ci = children.length;\r\n        while (ci--) {\r\n            this.remove_node(children[ci]);\r\n        }\r\n        // clean all children\r\n        children.length = 0;\r\n        var node_parent = node.parent;\r\n        // remove from parent's children\r\n        var sibling = node_parent.children;\r\n        var si = sibling.length;\r\n        while (si--) {\r\n            if (sibling[si].id == node.id) {\r\n                sibling.splice(si, 1);\r\n                break;\r\n            }\r\n        }\r\n        // remove from global nodes\r\n        delete this.nodes[node.id];\r\n        // clean all properties\r\n        for (var k in node) {\r\n            delete node[k];\r\n        }\r\n        // remove it's self\r\n        node = null;\r\n        this._update_index(node_parent);\r\n        return true;\r\n    }\r\n    _put_node(node) {\r\n        if (node.id in this.nodes) {\r\n            logger.warn(\"the node_id '\" + node.id + \"' has been already exist.\");\r\n            return false;\r\n        } else {\r\n            this.nodes[node.id] = node;\r\n            return true;\r\n        }\r\n    }\r\n    _update_index(node) {\r\n        if (node instanceof Node) {\r\n            node.children.sort(Node.compare);\r\n            for (var i = 0; i < node.children.length; i++) {\r\n                node.children[i].index = i + 1;\r\n            }\r\n        }\r\n    }\r\n}\r\n","/**\r\n * @license BSD\r\n * @copyright 2014-2023 hizzgdev@163.com\r\n *\r\n * Project Home:\r\n *   https://github.com/hizzgdev/jsmind/\r\n */\r\n\r\nimport { __author__, __version__, logger, Direction } from './jsmind.common.js';\r\nimport { Mind } from './jsmind.mind.js';\r\nimport { Node } from './jsmind.node.js';\r\nimport { util } from './jsmind.util.js';\r\n\r\nconst DEFAULT_META = { name: 'jsMind', author: __author__, version: __version__ };\r\n\r\nexport const format = {\r\n    node_tree: {\r\n        example: {\r\n            meta: DEFAULT_META,\r\n            format: 'node_tree',\r\n            data: { id: 'root', topic: 'jsMind node_tree example' },\r\n        },\r\n        get_mind: function (source) {\r\n            var df = format.node_tree;\r\n            var mind = new Mind();\r\n            mind.name = source.meta.name;\r\n            mind.author = source.meta.author;\r\n            mind.version = source.meta.version;\r\n            df._parse(mind, source.data);\r\n            return mind;\r\n        },\r\n        get_data: function (mind) {\r\n            var df = format.node_tree;\r\n            var json = {};\r\n            json.meta = {\r\n                name: mind.name,\r\n                author: mind.author,\r\n                version: mind.version,\r\n            };\r\n            json.format = 'node_tree';\r\n            json.data = df._build_node(mind.root);\r\n            return json;\r\n        },\r\n\r\n        _parse: function (mind, node_root) {\r\n            var df = format.node_tree;\r\n            var data = df._extract_data(node_root);\r\n            mind.set_root(node_root.id, node_root.topic, data);\r\n            if ('children' in node_root) {\r\n                var children = node_root.children;\r\n                for (var i = 0; i < children.length; i++) {\r\n                    df._extract_subnode(mind, mind.root, children[i]);\r\n                }\r\n            }\r\n        },\r\n\r\n        _extract_data: function (node_json) {\r\n            var data = {};\r\n            for (var k in node_json) {\r\n                if (\r\n                    k == 'id' ||\r\n                    k == 'topic' ||\r\n                    k == 'children' ||\r\n                    k == 'direction' ||\r\n                    k == 'expanded'\r\n                ) {\r\n                    continue;\r\n                }\r\n                data[k] = node_json[k];\r\n            }\r\n            return data;\r\n        },\r\n\r\n        _extract_subnode: function (mind, node_parent, node_json) {\r\n            var df = format.node_tree;\r\n            var data = df._extract_data(node_json);\r\n            var d = null;\r\n            if (node_parent.isroot) {\r\n                d = node_json.direction == 'left' ? Direction.left : Direction.right;\r\n            }\r\n            var node = mind.add_node(\r\n                node_parent,\r\n                node_json.id,\r\n                node_json.topic,\r\n                data,\r\n                d,\r\n                node_json.expanded\r\n            );\r\n            if (!!node_json['children']) {\r\n                var children = node_json.children;\r\n                for (var i = 0; i < children.length; i++) {\r\n                    df._extract_subnode(mind, node, children[i]);\r\n                }\r\n            }\r\n        },\r\n\r\n        _build_node: function (node) {\r\n            var df = format.node_tree;\r\n            if (!(node instanceof Node)) {\r\n                return;\r\n            }\r\n            var o = {\r\n                id: node.id,\r\n                topic: node.topic,\r\n                expanded: node.expanded,\r\n            };\r\n            if (!!node.parent && node.parent.isroot) {\r\n                o.direction = node.direction == Direction.left ? 'left' : 'right';\r\n            }\r\n            if (node.data != null) {\r\n                var node_data = node.data;\r\n                for (var k in node_data) {\r\n                    o[k] = node_data[k];\r\n                }\r\n            }\r\n            var children = node.children;\r\n            if (children.length > 0) {\r\n                o.children = [];\r\n                for (var i = 0; i < children.length; i++) {\r\n                    o.children.push(df._build_node(children[i]));\r\n                }\r\n            }\r\n            return o;\r\n        },\r\n    },\r\n\r\n    node_array: {\r\n        example: {\r\n            meta: DEFAULT_META,\r\n            format: 'node_array',\r\n            data: [{ id: 'root', topic: 'jsMind node_array example', isroot: true }],\r\n        },\r\n\r\n        get_mind: function (source) {\r\n            var df = format.node_array;\r\n            var mind = new Mind();\r\n            mind.name = source.meta.name;\r\n            mind.author = source.meta.author;\r\n            mind.version = source.meta.version;\r\n            df._parse(mind, source.data);\r\n            return mind;\r\n        },\r\n\r\n        get_data: function (mind) {\r\n            var df = format.node_array;\r\n            var json = {};\r\n            json.meta = {\r\n                name: mind.name,\r\n                author: mind.author,\r\n                version: mind.version,\r\n            };\r\n            json.format = 'node_array';\r\n            json.data = [];\r\n            df._array(mind, json.data);\r\n            return json;\r\n        },\r\n\r\n        _parse: function (mind, node_array) {\r\n            var df = format.node_array;\r\n            var nodes = node_array.slice(0);\r\n            // reverse array for improving looping performance\r\n            nodes.reverse();\r\n            var root_node = df._extract_root(mind, nodes);\r\n            if (!!root_node) {\r\n                df._extract_subnode(mind, root_node, nodes);\r\n            } else {\r\n                logger.error('root node can not be found');\r\n            }\r\n        },\r\n\r\n        _extract_root: function (mind, node_array) {\r\n            var df = format.node_array;\r\n            var i = node_array.length;\r\n            while (i--) {\r\n                if ('isroot' in node_array[i] && node_array[i].isroot) {\r\n                    var root_json = node_array[i];\r\n                    var data = df._extract_data(root_json);\r\n                    var node = mind.set_root(root_json.id, root_json.topic, data);\r\n                    node_array.splice(i, 1);\r\n                    return node;\r\n                }\r\n            }\r\n            return null;\r\n        },\r\n\r\n        _extract_subnode: function (mind, parent_node, node_array) {\r\n            var df = format.node_array;\r\n            var i = node_array.length;\r\n            var node_json = null;\r\n            var data = null;\r\n            var extract_count = 0;\r\n            while (i--) {\r\n                node_json = node_array[i];\r\n                if (node_json.parentid == parent_node.id) {\r\n                    data = df._extract_data(node_json);\r\n                    var d = null;\r\n                    var node_direction = node_json.direction;\r\n                    if (!!node_direction) {\r\n                        d = node_direction == 'left' ? Direction.left : Direction.right;\r\n                    }\r\n                    var node = mind.add_node(\r\n                        parent_node,\r\n                        node_json.id,\r\n                        node_json.topic,\r\n                        data,\r\n                        d,\r\n                        node_json.expanded\r\n                    );\r\n                    node_array.splice(i, 1);\r\n                    extract_count++;\r\n                    var sub_extract_count = df._extract_subnode(mind, node, node_array);\r\n                    if (sub_extract_count > 0) {\r\n                        // reset loop index after extract subordinate node\r\n                        i = node_array.length;\r\n                        extract_count += sub_extract_count;\r\n                    }\r\n                }\r\n            }\r\n            return extract_count;\r\n        },\r\n\r\n        _extract_data: function (node_json) {\r\n            var data = {};\r\n            for (var k in node_json) {\r\n                if (\r\n                    k == 'id' ||\r\n                    k == 'topic' ||\r\n                    k == 'parentid' ||\r\n                    k == 'isroot' ||\r\n                    k == 'direction' ||\r\n                    k == 'expanded'\r\n                ) {\r\n                    continue;\r\n                }\r\n                data[k] = node_json[k];\r\n            }\r\n            return data;\r\n        },\r\n\r\n        _array: function (mind, node_array) {\r\n            var df = format.node_array;\r\n            df._array_node(mind.root, node_array);\r\n        },\r\n\r\n        _array_node: function (node, node_array) {\r\n            var df = format.node_array;\r\n            if (!(node instanceof Node)) {\r\n                return;\r\n            }\r\n            var o = {\r\n                id: node.id,\r\n                topic: node.topic,\r\n                expanded: node.expanded,\r\n            };\r\n            if (!!node.parent) {\r\n                o.parentid = node.parent.id;\r\n            }\r\n            if (node.isroot) {\r\n                o.isroot = true;\r\n            }\r\n            if (!!node.parent && node.parent.isroot) {\r\n                o.direction = node.direction == Direction.left ? 'left' : 'right';\r\n            }\r\n            if (node.data != null) {\r\n                var node_data = node.data;\r\n                for (var k in node_data) {\r\n                    o[k] = node_data[k];\r\n                }\r\n            }\r\n            node_array.push(o);\r\n            var ci = node.children.length;\r\n            for (var i = 0; i < ci; i++) {\r\n                df._array_node(node.children[i], node_array);\r\n            }\r\n        },\r\n    },\r\n\r\n    freemind: {\r\n        example: {\r\n            meta: DEFAULT_META,\r\n            format: 'freemind',\r\n            data: '<map version=\"1.0.1\"><node ID=\"root\" TEXT=\"jsMind freemind example\"/></map>',\r\n        },\r\n        get_mind: function (source) {\r\n            var df = format.freemind;\r\n            var mind = new Mind();\r\n            mind.name = source.meta.name;\r\n            mind.author = source.meta.author;\r\n            mind.version = source.meta.version;\r\n            var xml = source.data;\r\n            var xml_doc = df._parse_xml(xml);\r\n            var xml_root = df._find_root(xml_doc);\r\n            df._load_node(mind, null, xml_root);\r\n            return mind;\r\n        },\r\n\r\n        get_data: function (mind) {\r\n            var df = format.freemind;\r\n            var json = {};\r\n            json.meta = {\r\n                name: mind.name,\r\n                author: mind.author,\r\n                version: mind.version,\r\n            };\r\n            json.format = 'freemind';\r\n            var xml_lines = [];\r\n            xml_lines.push('<map version=\"1.0.1\">');\r\n            df._build_map(mind.root, xml_lines);\r\n            xml_lines.push('</map>');\r\n            json.data = xml_lines.join('');\r\n            return json;\r\n        },\r\n\r\n        _parse_xml: function (xml) {\r\n            var xml_doc = null;\r\n            if (window.DOMParser) {\r\n                var parser = new DOMParser();\r\n                xml_doc = parser.parseFromString(xml, 'text/xml');\r\n            } else {\r\n                // Internet Explorer\r\n                xml_doc = new ActiveXObject('Microsoft.XMLDOM');\r\n                xml_doc.async = false;\r\n                xml_doc.loadXML(xml);\r\n            }\r\n            return xml_doc;\r\n        },\r\n\r\n        _find_root: function (xml_doc) {\r\n            var nodes = xml_doc.childNodes;\r\n            var node = null;\r\n            var root = null;\r\n            var n = null;\r\n            for (var i = 0; i < nodes.length; i++) {\r\n                n = nodes[i];\r\n                if (n.nodeType == 1 && n.tagName == 'map') {\r\n                    node = n;\r\n                    break;\r\n                }\r\n            }\r\n            if (!!node) {\r\n                var ns = node.childNodes;\r\n                node = null;\r\n                for (var i = 0; i < ns.length; i++) {\r\n                    n = ns[i];\r\n                    if (n.nodeType == 1 && n.tagName == 'node') {\r\n                        node = n;\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            return node;\r\n        },\r\n\r\n        _load_node: function (mind, parent_node, xml_node) {\r\n            var df = format.freemind;\r\n            var node_id = xml_node.getAttribute('ID');\r\n            var node_topic = xml_node.getAttribute('TEXT');\r\n            var node_folded = xml_node.getAttribute('FOLDED');\r\n            // look for richcontent\r\n            if (node_topic == null) {\r\n                var topic_children = xml_node.childNodes;\r\n                var topic_child = null;\r\n                for (var i = 0; i < topic_children.length; i++) {\r\n                    topic_child = topic_children[i];\r\n                    if (topic_child.nodeType == 1 && topic_child.tagName === 'richcontent') {\r\n                        node_topic = topic_child.textContent;\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            var node_data = df._load_attributes(xml_node);\r\n            var node_expanded =\r\n                'expanded' in node_data ? node_data.expanded == 'true' : node_folded != 'true';\r\n            delete node_data.expanded;\r\n\r\n            var node_position = xml_node.getAttribute('POSITION');\r\n            var node_direction = null;\r\n            if (!!node_position) {\r\n                node_direction = node_position == 'left' ? Direction.left : Direction.right;\r\n            }\r\n            var node = null;\r\n            if (!!parent_node) {\r\n                node = mind.add_node(\r\n                    parent_node,\r\n                    node_id,\r\n                    node_topic,\r\n                    node_data,\r\n                    node_direction,\r\n                    node_expanded\r\n                );\r\n            } else {\r\n                node = mind.set_root(node_id, node_topic, node_data);\r\n            }\r\n            var children = xml_node.childNodes;\r\n            var child = null;\r\n            for (var i = 0; i < children.length; i++) {\r\n                child = children[i];\r\n                if (child.nodeType == 1 && child.tagName == 'node') {\r\n                    df._load_node(mind, node, child);\r\n                }\r\n            }\r\n        },\r\n\r\n        _load_attributes: function (xml_node) {\r\n            var children = xml_node.childNodes;\r\n            var attr = null;\r\n            var attr_data = {};\r\n            for (var i = 0; i < children.length; i++) {\r\n                attr = children[i];\r\n                if (attr.nodeType == 1 && attr.tagName === 'attribute') {\r\n                    attr_data[attr.getAttribute('NAME')] = attr.getAttribute('VALUE');\r\n                }\r\n            }\r\n            return attr_data;\r\n        },\r\n\r\n        _build_map: function (node, xml_lines) {\r\n            var df = format.freemind;\r\n            var pos = null;\r\n            if (!!node.parent && node.parent.isroot) {\r\n                pos = node.direction === Direction.left ? 'left' : 'right';\r\n            }\r\n            xml_lines.push('<node');\r\n            xml_lines.push(' ID=\"' + node.id + '\"');\r\n            if (!!pos) {\r\n                xml_lines.push(' POSITION=\"' + pos + '\"');\r\n            }\r\n            if (!node.expanded) {\r\n                xml_lines.push(' FOLDED=\"true\"');\r\n            }\r\n            xml_lines.push(' TEXT=\"' + df._escape(node.topic) + '\">');\r\n\r\n            // for attributes\r\n            var node_data = node.data;\r\n            if (node_data != null) {\r\n                for (var k in node_data) {\r\n                    xml_lines.push('<attribute NAME=\"' + k + '\" VALUE=\"' + node_data[k] + '\"/>');\r\n                }\r\n            }\r\n\r\n            // for children\r\n            var children = node.children;\r\n            for (var i = 0; i < children.length; i++) {\r\n                df._build_map(children[i], xml_lines);\r\n            }\r\n\r\n            xml_lines.push('</node>');\r\n        },\r\n\r\n        _escape: function (text) {\r\n            return text\r\n                .replace(/&/g, '&amp;')\r\n                .replace(/</g, '&lt;')\r\n                .replace(/>/g, '&gt;')\r\n                .replace(/'/g, '&apos;')\r\n                .replace(/\"/g, '&quot;');\r\n        },\r\n    },\r\n    text: {\r\n        example: {\r\n            meta: DEFAULT_META,\r\n            format: 'text',\r\n            data: 'jsMind text example\\n node1\\n  node1-sub\\n  node1-sub\\n node2',\r\n        },\r\n        _line_regex: /\\s*/,\r\n        get_mind: function (source) {\r\n            var df = format.text;\r\n            var mind = new Mind();\r\n            mind.name = source.meta.name;\r\n            mind.author = source.meta.author;\r\n            mind.version = source.meta.version;\r\n            var lines = source.data.split(/\\n|\\r/);\r\n            df._fill_nodes(mind, lines, 0, 0);\r\n            return mind;\r\n        },\r\n\r\n        _fill_nodes: function (mind, lines) {\r\n            let node_path = [];\r\n            let i = 0;\r\n            while (i < lines.length) {\r\n                let line = lines[i];\r\n                let level = line.match(/\\s*/)[0].length;\r\n                let topic = line.substr(level);\r\n\r\n                if (level == 0 && node_path.length > 0) {\r\n                    log.error('more than 1 root node was found: ' + topic);\r\n                    return;\r\n                }\r\n                if (level > node_path.length) {\r\n                    log.error('a suspended node was found: ' + topic);\r\n                    return;\r\n                }\r\n                let diff = node_path.length - level;\r\n                while (diff--) {\r\n                    node_path.pop();\r\n                }\r\n\r\n                if (level == 0 && node_path.length == 0) {\r\n                    let node = mind.set_root(util.uuid.newid(), topic);\r\n                    node_path.push(node);\r\n                } else {\r\n                    let node = mind.add_node(\r\n                        node_path[level - 1],\r\n                        util.uuid.newid(),\r\n                        topic,\r\n                        {},\r\n                        null\r\n                    );\r\n                    node_path.push(node);\r\n                }\r\n                i++;\r\n            }\r\n            node_path.length = 0;\r\n        },\r\n\r\n        get_data: function (mind) {\r\n            var df = format.text;\r\n            var json = {};\r\n            json.meta = {\r\n                name: mind.name,\r\n                author: mind.author,\r\n                version: mind.version,\r\n            };\r\n            json.format = 'text';\r\n            let lines = [];\r\n            df._build_lines(lines, [mind.root], 0);\r\n            json.data = lines.join('\\n');\r\n            return json;\r\n        },\r\n\r\n        _build_lines: function (lines, nodes, level) {\r\n            let prefix = new Array(level + 1).join(' ');\r\n            for (let node of nodes) {\r\n                lines.push(prefix + node.topic);\r\n                if (!!node.children) {\r\n                    format.text._build_lines(lines, node.children, level + 1);\r\n                }\r\n            }\r\n        },\r\n    },\r\n};\r\n","/**\r\n * @license BSD\r\n * @copyright 2014-2023 hizzgdev@163.com\r\n *\r\n * Project Home:\r\n *   https://github.com/hizzgdev/jsmind/\r\n */\r\n\r\nimport { logger } from './jsmind.common.js';\r\nimport { format } from './jsmind.format.js';\r\n\r\nexport class DataProvider {\r\n    constructor(jm) {\r\n        this.jm = jm;\r\n    }\r\n\r\n    init() {\r\n        logger.debug('data.init');\r\n    }\r\n    reset() {\r\n        logger.debug('data.reset');\r\n    }\r\n    load(mind_data) {\r\n        var df = null;\r\n        var mind = null;\r\n        if (typeof mind_data === 'object') {\r\n            if (!!mind_data.format) {\r\n                df = mind_data.format;\r\n            } else {\r\n                df = 'node_tree';\r\n            }\r\n        } else {\r\n            df = 'freemind';\r\n        }\r\n\r\n        if (df == 'node_array') {\r\n            mind = format.node_array.get_mind(mind_data);\r\n        } else if (df == 'node_tree') {\r\n            mind = format.node_tree.get_mind(mind_data);\r\n        } else if (df == 'freemind') {\r\n            mind = format.freemind.get_mind(mind_data);\r\n        } else if (df == 'text') {\r\n            mind = format.text.get_mind(mind_data);\r\n        } else {\r\n            logger.warn('unsupported format');\r\n        }\r\n        return mind;\r\n    }\r\n    get_data(data_format) {\r\n        var data = null;\r\n        if (data_format == 'node_array') {\r\n            data = format.node_array.get_data(this.jm.mind);\r\n        } else if (data_format == 'node_tree') {\r\n            data = format.node_tree.get_data(this.jm.mind);\r\n        } else if (data_format == 'freemind') {\r\n            data = format.freemind.get_data(this.jm.mind);\r\n        } else if (data_format == 'text') {\r\n            data = format.text.get_data(this.jm.mind);\r\n        } else {\r\n            logger.error('unsupported ' + data_format + ' format');\r\n        }\r\n        return data;\r\n    }\r\n}\r\n","/**\r\n * @license BSD\r\n * @copyright 2014-2023 hizzgdev@163.com\r\n *\r\n * Project Home:\r\n *   https://github.com/hizzgdev/jsmind/\r\n */\r\nimport { logger, Direction, EventType } from './jsmind.common.js';\r\n\r\nexport class LayoutProvider {\r\n    constructor(jm, options) {\r\n        this.opts = options;\r\n        this.jm = jm;\r\n        this.isside = this.opts.mode == 'side';\r\n        this.bounds = null;\r\n\r\n        this.cache_valid = false;\r\n    }\r\n    init() {\r\n        logger.debug('layout.init');\r\n    }\r\n    reset() {\r\n        logger.debug('layout.reset');\r\n        this.bounds = { n: 0, s: 0, w: 0, e: 0 };\r\n    }\r\n    calculate_next_child_direction(node) {\r\n        if (this.isside) {\r\n            return Direction.right;\r\n        }\r\n        var children = node.children || [];\r\n        var children_len = children.length;\r\n        var r = 0;\r\n        for (var i = 0; i < children_len; i++) {\r\n            if (children[i].direction === Direction.left) {\r\n                r--;\r\n            } else {\r\n                r++;\r\n            }\r\n        }\r\n        return children_len > 1 && r > 0 ? Direction.left : Direction.right;\r\n    }\r\n    layout() {\r\n        logger.debug('layout.layout');\r\n        this.layout_direction();\r\n        this.layout_offset();\r\n    }\r\n    layout_direction() {\r\n        this._layout_direction_root();\r\n    }\r\n    _layout_direction_root() {\r\n        var node = this.jm.mind.root;\r\n        var layout_data = null;\r\n        if ('layout' in node._data) {\r\n            layout_data = node._data.layout;\r\n        } else {\r\n            layout_data = {};\r\n            node._data.layout = layout_data;\r\n        }\r\n        var children = node.children;\r\n        var children_count = children.length;\r\n        layout_data.direction = Direction.center;\r\n        layout_data.side_index = 0;\r\n        if (this.isside) {\r\n            var i = children_count;\r\n            while (i--) {\r\n                this._layout_direction_side(children[i], Direction.right, i);\r\n            }\r\n        } else {\r\n            var i = children_count;\r\n            var subnode = null;\r\n            while (i--) {\r\n                subnode = children[i];\r\n                if (subnode.direction == Direction.left) {\r\n                    this._layout_direction_side(subnode, Direction.left, i);\r\n                } else {\r\n                    this._layout_direction_side(subnode, Direction.right, i);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    _layout_direction_side(node, direction, side_index) {\r\n        var layout_data = null;\r\n        if ('layout' in node._data) {\r\n            layout_data = node._data.layout;\r\n        } else {\r\n            layout_data = {};\r\n            node._data.layout = layout_data;\r\n        }\r\n        var children = node.children;\r\n        var children_count = children.length;\r\n\r\n        layout_data.direction = direction;\r\n        layout_data.side_index = side_index;\r\n        var i = children_count;\r\n        while (i--) {\r\n            this._layout_direction_side(children[i], direction, i);\r\n        }\r\n    }\r\n    layout_offset() {\r\n        var node = this.jm.mind.root;\r\n        var layout_data = node._data.layout;\r\n        layout_data.offset_x = 0;\r\n        layout_data.offset_y = 0;\r\n        layout_data.outer_height = 0;\r\n        var children = node.children;\r\n        var i = children.length;\r\n        var left_nodes = [];\r\n        var right_nodes = [];\r\n        var subnode = null;\r\n        while (i--) {\r\n            subnode = children[i];\r\n            if (subnode._data.layout.direction == Direction.right) {\r\n                right_nodes.unshift(subnode);\r\n            } else {\r\n                left_nodes.unshift(subnode);\r\n            }\r\n        }\r\n        layout_data.left_nodes = left_nodes;\r\n        layout_data.right_nodes = right_nodes;\r\n        layout_data.outer_height_left = this._layout_offset_subnodes(left_nodes);\r\n        layout_data.outer_height_right = this._layout_offset_subnodes(right_nodes);\r\n        this.bounds.e = node._data.view.width / 2;\r\n        this.bounds.w = 0 - this.bounds.e;\r\n        this.bounds.n = 0;\r\n        this.bounds.s = Math.max(layout_data.outer_height_left, layout_data.outer_height_right);\r\n    }\r\n    // layout both the x and y axis\r\n    _layout_offset_subnodes(nodes) {\r\n        var total_height = 0;\r\n        var nodes_count = nodes.length;\r\n        var i = nodes_count;\r\n        var node = null;\r\n        var node_outer_height = 0;\r\n        var layout_data = null;\r\n        var base_y = 0;\r\n        var pd = null; // parent._data\r\n        while (i--) {\r\n            node = nodes[i];\r\n            layout_data = node._data.layout;\r\n            if (pd == null) {\r\n                pd = node.parent._data;\r\n            }\r\n\r\n            node_outer_height = this._layout_offset_subnodes(node.children);\r\n            if (!node.expanded) {\r\n                node_outer_height = 0;\r\n                this.set_visible(node.children, false);\r\n            }\r\n            node_outer_height = Math.max(node._data.view.height, node_outer_height);\r\n            if (node.children.length > 1) {\r\n                node_outer_height += this.opts.cousin_space;\r\n            }\r\n\r\n            layout_data.outer_height = node_outer_height;\r\n            layout_data.offset_y = base_y - node_outer_height / 2;\r\n            layout_data.offset_x =\r\n                this.opts.hspace * layout_data.direction +\r\n                (pd.view.width * (pd.layout.direction + layout_data.direction)) / 2;\r\n            if (!node.parent.isroot) {\r\n                layout_data.offset_x += this.opts.pspace * layout_data.direction;\r\n            }\r\n\r\n            base_y = base_y - node_outer_height - this.opts.vspace;\r\n            total_height += node_outer_height;\r\n        }\r\n        if (nodes_count > 1) {\r\n            total_height += this.opts.vspace * (nodes_count - 1);\r\n        }\r\n        i = nodes_count;\r\n        var middle_height = total_height / 2;\r\n        while (i--) {\r\n            node = nodes[i];\r\n            node._data.layout.offset_y += middle_height;\r\n        }\r\n        return total_height;\r\n    }\r\n    // layout the y axis only, for collapse/expand a node\r\n    _layout_offset_subnodes_height(nodes) {\r\n        var total_height = 0;\r\n        var nodes_count = nodes.length;\r\n        var i = nodes_count;\r\n        var node = null;\r\n        var node_outer_height = 0;\r\n        var layout_data = null;\r\n        var base_y = 0;\r\n        var pd = null; // parent._data\r\n        while (i--) {\r\n            node = nodes[i];\r\n            layout_data = node._data.layout;\r\n            if (pd == null) {\r\n                pd = node.parent._data;\r\n            }\r\n\r\n            node_outer_height = this._layout_offset_subnodes_height(node.children);\r\n            if (!node.expanded) {\r\n                node_outer_height = 0;\r\n            }\r\n            node_outer_height = Math.max(node._data.view.height, node_outer_height);\r\n            if (node.children.length > 1) {\r\n                node_outer_height += this.opts.cousin_space;\r\n            }\r\n\r\n            layout_data.outer_height = node_outer_height;\r\n            layout_data.offset_y = base_y - node_outer_height / 2;\r\n            base_y = base_y - node_outer_height - this.opts.vspace;\r\n            total_height += node_outer_height;\r\n        }\r\n        if (nodes_count > 1) {\r\n            total_height += this.opts.vspace * (nodes_count - 1);\r\n        }\r\n        i = nodes_count;\r\n        var middle_height = total_height / 2;\r\n        while (i--) {\r\n            node = nodes[i];\r\n            node._data.layout.offset_y += middle_height;\r\n        }\r\n        return total_height;\r\n    }\r\n    get_node_offset(node) {\r\n        var layout_data = node._data.layout;\r\n        var offset_cache = null;\r\n        if ('_offset_' in layout_data && this.cache_valid) {\r\n            offset_cache = layout_data._offset_;\r\n        } else {\r\n            offset_cache = { x: -1, y: -1 };\r\n            layout_data._offset_ = offset_cache;\r\n        }\r\n        if (offset_cache.x == -1 || offset_cache.y == -1) {\r\n            var x = layout_data.offset_x;\r\n            var y = layout_data.offset_y;\r\n            if (!node.isroot) {\r\n                var offset_p = this.get_node_offset(node.parent);\r\n                x += offset_p.x;\r\n                y += offset_p.y;\r\n            }\r\n            offset_cache.x = x;\r\n            offset_cache.y = y;\r\n        }\r\n        return offset_cache;\r\n    }\r\n    get_node_point(node) {\r\n        var view_data = node._data.view;\r\n        var offset_p = this.get_node_offset(node);\r\n        var p = {};\r\n        p.x = offset_p.x + (view_data.width * (node._data.layout.direction - 1)) / 2;\r\n        p.y = offset_p.y - view_data.height / 2;\r\n        return p;\r\n    }\r\n    get_node_point_in(node) {\r\n        var p = this.get_node_offset(node);\r\n        return p;\r\n    }\r\n    get_node_point_out(node) {\r\n        var layout_data = node._data.layout;\r\n        var pout_cache = null;\r\n        if ('_pout_' in layout_data && this.cache_valid) {\r\n            pout_cache = layout_data._pout_;\r\n        } else {\r\n            pout_cache = { x: -1, y: -1 };\r\n            layout_data._pout_ = pout_cache;\r\n        }\r\n        if (pout_cache.x == -1 || pout_cache.y == -1) {\r\n            if (node.isroot) {\r\n                pout_cache.x = 0;\r\n                pout_cache.y = 0;\r\n            } else {\r\n                var view_data = node._data.view;\r\n                var offset_p = this.get_node_offset(node);\r\n                pout_cache.x =\r\n                    offset_p.x + (view_data.width + this.opts.pspace) * node._data.layout.direction;\r\n                pout_cache.y = offset_p.y;\r\n            }\r\n        }\r\n        return pout_cache;\r\n    }\r\n    get_expander_point(node) {\r\n        var p = this.get_node_point_out(node);\r\n        var ex_p = {};\r\n        if (node._data.layout.direction == Direction.right) {\r\n            ex_p.x = p.x - this.opts.pspace;\r\n        } else {\r\n            ex_p.x = p.x;\r\n        }\r\n        ex_p.y = p.y - Math.ceil(this.opts.pspace / 2);\r\n        return ex_p;\r\n    }\r\n    get_min_size() {\r\n        var nodes = this.jm.mind.nodes;\r\n        var node = null;\r\n        var pout = null;\r\n        for (var node_id in nodes) {\r\n            node = nodes[node_id];\r\n            pout = this.get_node_point_out(node);\r\n            if (pout.x > this.bounds.e) {\r\n                this.bounds.e = pout.x;\r\n            }\r\n            if (pout.x < this.bounds.w) {\r\n                this.bounds.w = pout.x;\r\n            }\r\n        }\r\n        return {\r\n            w: this.bounds.e - this.bounds.w,\r\n            h: this.bounds.s - this.bounds.n,\r\n        };\r\n    }\r\n    toggle_node(node) {\r\n        if (node.isroot) {\r\n            return;\r\n        }\r\n        if (node.expanded) {\r\n            this.collapse_node(node);\r\n        } else {\r\n            this.expand_node(node);\r\n        }\r\n    }\r\n    expand_node(node) {\r\n        node.expanded = true;\r\n        this.part_layout(node);\r\n        this.set_visible(node.children, true);\r\n        this.jm.invoke_event_handle(EventType.show, {\r\n            evt: 'expand_node',\r\n            data: [],\r\n            node: node.id,\r\n        });\r\n    }\r\n    collapse_node(node) {\r\n        node.expanded = false;\r\n        this.part_layout(node);\r\n        this.set_visible(node.children, false);\r\n        this.jm.invoke_event_handle(EventType.show, {\r\n            evt: 'collapse_node',\r\n            data: [],\r\n            node: node.id,\r\n        });\r\n    }\r\n    expand_all() {\r\n        var nodes = this.jm.mind.nodes;\r\n        var c = 0;\r\n        var node;\r\n        for (var node_id in nodes) {\r\n            node = nodes[node_id];\r\n            if (!node.expanded) {\r\n                node.expanded = true;\r\n                c++;\r\n            }\r\n        }\r\n        if (c > 0) {\r\n            var root = this.jm.mind.root;\r\n            this.part_layout(root);\r\n            this.set_visible(root.children, true);\r\n        }\r\n    }\r\n    collapse_all() {\r\n        var nodes = this.jm.mind.nodes;\r\n        var c = 0;\r\n        var node;\r\n        for (var node_id in nodes) {\r\n            node = nodes[node_id];\r\n            if (node.expanded && !node.isroot) {\r\n                node.expanded = false;\r\n                c++;\r\n            }\r\n        }\r\n        if (c > 0) {\r\n            var root = this.jm.mind.root;\r\n            this.part_layout(root);\r\n            this.set_visible(root.children, true);\r\n        }\r\n    }\r\n    expand_to_depth(target_depth, curr_nodes, curr_depth) {\r\n        if (target_depth < 1) {\r\n            return;\r\n        }\r\n        var nodes = curr_nodes || this.jm.mind.root.children;\r\n        var depth = curr_depth || 1;\r\n        var i = nodes.length;\r\n        var node = null;\r\n        while (i--) {\r\n            node = nodes[i];\r\n            if (depth < target_depth) {\r\n                if (!node.expanded) {\r\n                    this.expand_node(node);\r\n                }\r\n                this.expand_to_depth(target_depth, node.children, depth + 1);\r\n            }\r\n            if (depth == target_depth) {\r\n                if (node.expanded) {\r\n                    this.collapse_node(node);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    part_layout(node) {\r\n        var root = this.jm.mind.root;\r\n        if (!!root) {\r\n            var root_layout_data = root._data.layout;\r\n            if (node.isroot) {\r\n                root_layout_data.outer_height_right = this._layout_offset_subnodes_height(\r\n                    root_layout_data.right_nodes\r\n                );\r\n                root_layout_data.outer_height_left = this._layout_offset_subnodes_height(\r\n                    root_layout_data.left_nodes\r\n                );\r\n            } else {\r\n                if (node._data.layout.direction == Direction.right) {\r\n                    root_layout_data.outer_height_right = this._layout_offset_subnodes_height(\r\n                        root_layout_data.right_nodes\r\n                    );\r\n                } else {\r\n                    root_layout_data.outer_height_left = this._layout_offset_subnodes_height(\r\n                        root_layout_data.left_nodes\r\n                    );\r\n                }\r\n            }\r\n            this.bounds.s = Math.max(\r\n                root_layout_data.outer_height_left,\r\n                root_layout_data.outer_height_right\r\n            );\r\n            this.cache_valid = false;\r\n        } else {\r\n            logger.warn('can not found root node');\r\n        }\r\n    }\r\n    set_visible(nodes, visible) {\r\n        var i = nodes.length;\r\n        var node = null;\r\n        var layout_data = null;\r\n        while (i--) {\r\n            node = nodes[i];\r\n            layout_data = node._data.layout;\r\n            if (node.expanded) {\r\n                this.set_visible(node.children, visible);\r\n            } else {\r\n                this.set_visible(node.children, false);\r\n            }\r\n            if (!node.isroot) {\r\n                node._data.layout.visible = visible;\r\n            }\r\n        }\r\n    }\r\n    is_expand(node) {\r\n        return node.expanded;\r\n    }\r\n    is_visible(node) {\r\n        var layout_data = node._data.layout;\r\n        if ('visible' in layout_data && !layout_data.visible) {\r\n            return false;\r\n        } else {\r\n            return true;\r\n        }\r\n    }\r\n}\r\n","/**\r\n * @license BSD\r\n * @copyright 2014-2023 hizzgdev@163.com\r\n *\r\n * Project Home:\r\n *   https://github.com/hizzgdev/jsmind/\r\n */\r\n\r\nimport { $ } from './jsmind.dom.js';\r\nimport { logger } from './jsmind.common.js';\r\n\r\nclass SvgGraph {\r\n    constructor(view) {\r\n        this.view = view;\r\n        this.opts = view.opts;\r\n        this.e_svg = SvgGraph.c('svg');\r\n        this.e_svg.setAttribute('class', 'jsmind');\r\n        this.size = { w: 0, h: 0 };\r\n        this.lines = [];\r\n        this.line_drawing = {\r\n            straight: this._line_to,\r\n            curved: this._bezier_to,\r\n        };\r\n        this.init_line_render();\r\n    }\r\n    static c(tag) {\r\n        return $.d.createElementNS('http://www.w3.org/2000/svg', tag);\r\n    }\r\n    init_line_render() {\r\n        if (typeof this.opts.custom_line_render === 'function') {\r\n            this.drawing = (path, x1, y1, x2, y2) => {\r\n                try {\r\n                    this.opts.custom_line_render.call(this, {\r\n                        ctx: path,\r\n                        start_point: { x: x1, y: y1 },\r\n                        end_point: { x: x2, y: y2 },\r\n                    });\r\n                } catch (e) {\r\n                    logger.error('custom line renderer error: ', e);\r\n                }\r\n            };\r\n        } else {\r\n            this.drawing = this.line_drawing[this.opts.line_style] || this.line_drawing.curved;\r\n        }\r\n    }\r\n    element() {\r\n        return this.e_svg;\r\n    }\r\n    set_size(w, h) {\r\n        this.size.w = w;\r\n        this.size.h = h;\r\n        this.e_svg.setAttribute('width', w);\r\n        this.e_svg.setAttribute('height', h);\r\n    }\r\n    clear() {\r\n        var len = this.lines.length;\r\n        while (len--) {\r\n            this.e_svg.removeChild(this.lines[len]);\r\n        }\r\n        this.lines.length = 0;\r\n    }\r\n    draw_line(pout, pin, offset, color) {\r\n        var line = SvgGraph.c('path');\r\n        line.setAttribute('stroke', color || this.opts.line_color);\r\n        line.setAttribute('stroke-width', this.opts.line_width);\r\n        line.setAttribute('fill', 'transparent');\r\n        this.lines.push(line);\r\n        this.e_svg.appendChild(line);\r\n        this.drawing(\r\n            line,\r\n            pin.x + offset.x,\r\n            pin.y + offset.y,\r\n            pout.x + offset.x,\r\n            pout.y + offset.y\r\n        );\r\n    }\r\n\r\n    copy_to(dest_canvas_ctx, callback) {\r\n        var img = new Image();\r\n        img.onload = function () {\r\n            dest_canvas_ctx.drawImage(img, 0, 0);\r\n            !!callback && callback();\r\n        };\r\n        img.src =\r\n            'data:image/svg+xml;base64,' + btoa(new XMLSerializer().serializeToString(this.e_svg));\r\n    }\r\n    _bezier_to(path, x1, y1, x2, y2) {\r\n        path.setAttribute(\r\n            'd',\r\n            'M ' +\r\n                x1 +\r\n                ' ' +\r\n                y1 +\r\n                ' C ' +\r\n                (x1 + ((x2 - x1) * 2) / 3) +\r\n                ' ' +\r\n                y1 +\r\n                ', ' +\r\n                x1 +\r\n                ' ' +\r\n                y2 +\r\n                ', ' +\r\n                x2 +\r\n                ' ' +\r\n                y2\r\n        );\r\n    }\r\n    _line_to(path, x1, y1, x2, y2) {\r\n        path.setAttribute('d', 'M ' + x1 + ' ' + y1 + ' L ' + x2 + ' ' + y2);\r\n    }\r\n}\r\n\r\nclass CanvasGraph {\r\n    constructor(view) {\r\n        this.opts = view.opts;\r\n        this.e_canvas = $.c('canvas');\r\n        this.e_canvas.className = 'jsmind';\r\n        this.canvas_ctx = this.e_canvas.getContext('2d');\r\n        this.size = { w: 0, h: 0 };\r\n        this.line_drawing = {\r\n            straight: this._line_to,\r\n            curved: this._bezier_to,\r\n        };\r\n        this.dpr = view.device_pixel_ratio;\r\n        this.init_line_render();\r\n    }\r\n    init_line_render() {\r\n        if (typeof this.opts.custom_line_render === 'function') {\r\n            this.drawing = (ctx, x1, y1, x2, y2) => {\r\n                try {\r\n                    this.opts.custom_line_render.call(this, {\r\n                        ctx,\r\n                        start_point: { x: x1, y: y1 },\r\n                        end_point: { x: x2, y: y2 },\r\n                    });\r\n                } catch (e) {\r\n                    logger.error('custom line render error: ', e);\r\n                }\r\n            };\r\n        } else {\r\n            this.drawing = this.line_drawing[this.opts.line_style] || this.line_drawing.curved;\r\n        }\r\n    }\r\n    element() {\r\n        return this.e_canvas;\r\n    }\r\n    set_size(w, h) {\r\n        this.size.w = w;\r\n        this.size.h = h;\r\n        if (this.e_canvas.width && this.e_canvas.height && this.canvas_ctx.scale) {\r\n            this.e_canvas.width = w * this.dpr;\r\n            this.e_canvas.height = h * this.dpr;\r\n\r\n            this.e_canvas.style.width = w + 'px';\r\n            this.e_canvas.style.height = h + 'px';\r\n            this.canvas_ctx.scale(this.dpr, this.dpr);\r\n        } else {\r\n            this.e_canvas.width = w;\r\n            this.e_canvas.height = h;\r\n        }\r\n    }\r\n\r\n    clear() {\r\n        this.canvas_ctx.clearRect(0, 0, this.size.w, this.size.h);\r\n    }\r\n    draw_line(pout, pin, offset, color) {\r\n        var ctx = this.canvas_ctx;\r\n        ctx.strokeStyle = color || this.opts.line_color;\r\n        ctx.lineWidth = this.opts.line_width;\r\n        ctx.lineCap = 'round';\r\n        this.drawing(ctx, pin.x + offset.x, pin.y + offset.y, pout.x + offset.x, pout.y + offset.y);\r\n    }\r\n    copy_to(dest_canvas_ctx, callback) {\r\n        dest_canvas_ctx.drawImage(this.e_canvas, 0, 0, this.size.w, this.size.h);\r\n        !!callback && callback();\r\n    }\r\n    _bezier_to(ctx, x1, y1, x2, y2) {\r\n        ctx.beginPath();\r\n        ctx.moveTo(x1, y1);\r\n        ctx.bezierCurveTo(x1 + ((x2 - x1) * 2) / 3, y1, x1, y2, x2, y2);\r\n        ctx.stroke();\r\n    }\r\n    _line_to(ctx, x1, y1, x2, y2) {\r\n        ctx.beginPath();\r\n        ctx.moveTo(x1, y1);\r\n        ctx.lineTo(x2, y2);\r\n        ctx.stroke();\r\n    }\r\n}\r\n\r\nexport function init_graph(view, engine) {\r\n    return engine.toLowerCase() === 'svg' ? new SvgGraph(view) : new CanvasGraph(view);\r\n}\r\n","/**\r\n * @license BSD\r\n * @copyright 2014-2023 hizzgdev@163.com\r\n *\r\n * Project Home:\r\n *   https://github.com/hizzgdev/jsmind/\r\n */\r\nimport { logger, EventType, Direction } from './jsmind.common.js';\r\nimport { $ } from './jsmind.dom.js';\r\nimport { init_graph } from './jsmind.graph.js';\r\nimport { util } from './jsmind.util.js';\r\n\r\nexport class ViewProvider {\r\n    constructor(jm, options) {\r\n        this.opts = options;\r\n        this.jm = jm;\r\n        this.layout = jm.layout;\r\n\r\n        this.container = null;\r\n        this.e_panel = null;\r\n        this.e_nodes = null;\r\n\r\n        this.size = { w: 0, h: 0 };\r\n\r\n        this.selected_node = null;\r\n        this.editing_node = null;\r\n\r\n        this.graph = null;\r\n        this.render_node = !!options.custom_node_render\r\n            ? this._custom_node_render\r\n            : this._default_node_render;\r\n        this.zoom_current = 1;\r\n        this.device_pixel_ratio = this.opts.enable_device_pixel_ratio\r\n            ? $.w.devicePixelRatio || 1\r\n            : 1;\r\n        this._initialized = false;\r\n    }\r\n    init() {\r\n        logger.debug(this.opts);\r\n        logger.debug('view.init');\r\n\r\n        this.container = $.i(this.opts.container) ? this.opts.container : $.g(this.opts.container);\r\n        if (!this.container) {\r\n            logger.error('the options.view.container was not be found in dom');\r\n            return;\r\n        }\r\n        this.graph = init_graph(this, this.opts.engine);\r\n\r\n        this.e_panel = $.c('div');\r\n        this.e_nodes = $.c('jmnodes');\r\n        this.e_editor = $.c('input');\r\n        this.e_panel.className = 'jsmind-inner jmnode-overflow-' + this.opts.node_overflow;\r\n        this.e_panel.tabIndex = 1;\r\n        this.e_panel.appendChild(this.graph.element());\r\n        this.e_panel.appendChild(this.e_nodes);\r\n\r\n        this.e_editor.className = 'jsmind-editor';\r\n        this.e_editor.type = 'text';\r\n\r\n        var v = this;\r\n        $.on(this.e_editor, 'keydown', function (e) {\r\n            var evt = e || event;\r\n            if (evt.keyCode == 13) {\r\n                v.edit_node_end();\r\n                evt.stopPropagation();\r\n            }\r\n        });\r\n        $.on(this.e_editor, 'blur', function (e) {\r\n            v.edit_node_end();\r\n        });\r\n\r\n        this.container.appendChild(this.e_panel);\r\n\r\n        if (!this.container.offsetParent) {\r\n            new IntersectionObserver((entities, observer) => {\r\n                if (entities[0].isIntersecting) {\r\n                    observer.unobserve(this.e_panel);\r\n                    this.resize();\r\n                }\r\n            }).observe(this.e_panel);\r\n        }\r\n    }\r\n\r\n    add_event(obj, event_name, event_handle, capture_by_panel) {\r\n        let target = !!capture_by_panel ? this.e_panel : this.e_nodes;\r\n        $.on(target, event_name, function (e) {\r\n            var evt = e || event;\r\n            event_handle.call(obj, evt);\r\n        });\r\n    }\r\n    get_binded_nodeid(element) {\r\n        if (element == null) {\r\n            return null;\r\n        }\r\n        var tagName = element.tagName.toLowerCase();\r\n        if (tagName == 'jmnode' || tagName == 'jmexpander') {\r\n            return element.getAttribute('nodeid');\r\n        } else if (tagName == 'jmnodes' || tagName == 'body' || tagName == 'html') {\r\n            return null;\r\n        } else {\r\n            return this.get_binded_nodeid(element.parentElement);\r\n        }\r\n    }\r\n    is_node(element) {\r\n        if (element == null) {\r\n            return false;\r\n        }\r\n        var tagName = element.tagName.toLowerCase();\r\n        if (tagName == 'jmnode') {\r\n            return true;\r\n        } else if (tagName == 'jmnodes' || tagName == 'body' || tagName == 'html') {\r\n            return false;\r\n        } else {\r\n            return this.is_node(element.parentElement);\r\n        }\r\n    }\r\n    is_expander(element) {\r\n        return element.tagName.toLowerCase() == 'jmexpander';\r\n    }\r\n    reset() {\r\n        logger.debug('view.reset');\r\n        this.selected_node = null;\r\n        this.clear_lines();\r\n        this.clear_nodes();\r\n        this.reset_theme();\r\n    }\r\n    reset_theme() {\r\n        var theme_name = this.jm.options.theme;\r\n        if (!!theme_name) {\r\n            this.e_nodes.className = 'theme-' + theme_name;\r\n        } else {\r\n            this.e_nodes.className = '';\r\n        }\r\n    }\r\n    reset_custom_style() {\r\n        var nodes = this.jm.mind.nodes;\r\n        for (var nodeid in nodes) {\r\n            this.reset_node_custom_style(nodes[nodeid]);\r\n        }\r\n    }\r\n    load() {\r\n        logger.debug('view.load');\r\n        this.setup_canvas_draggable(this.opts.draggable);\r\n        this.init_nodes();\r\n        this._initialized = true;\r\n    }\r\n    expand_size() {\r\n        var min_size = this.layout.get_min_size();\r\n        var min_width = min_size.w + this.opts.hmargin * 2;\r\n        var min_height = min_size.h + this.opts.vmargin * 2;\r\n        var client_w = this.e_panel.clientWidth;\r\n        var client_h = this.e_panel.clientHeight;\r\n        if (client_w < min_width) {\r\n            client_w = min_width;\r\n        }\r\n        if (client_h < min_height) {\r\n            client_h = min_height;\r\n        }\r\n        this.size.w = client_w;\r\n        this.size.h = client_h;\r\n    }\r\n    init_nodes_size(node) {\r\n        var view_data = node._data.view;\r\n        view_data.width = view_data.element.clientWidth;\r\n        view_data.height = view_data.element.clientHeight;\r\n    }\r\n    init_nodes() {\r\n        var nodes = this.jm.mind.nodes;\r\n        var doc_frag = $.d.createDocumentFragment();\r\n        for (var nodeid in nodes) {\r\n            this.create_node_element(nodes[nodeid], doc_frag);\r\n        }\r\n        this.e_nodes.appendChild(doc_frag);\r\n\r\n        this.run_in_c11y_mode_if_needed(() => {\r\n            for (var nodeid in nodes) {\r\n                this.init_nodes_size(nodes[nodeid]);\r\n            }\r\n        });\r\n    }\r\n    add_node(node) {\r\n        this.create_node_element(node, this.e_nodes);\r\n        this.run_in_c11y_mode_if_needed(() => {\r\n            this.init_nodes_size(node);\r\n        });\r\n    }\r\n    run_in_c11y_mode_if_needed(func) {\r\n        if (!!this.container.offsetParent) {\r\n            func();\r\n            return;\r\n        }\r\n        logger.warn(\r\n            'init nodes in compatibility mode. because the container or its parent has style {display:none}. '\r\n        );\r\n        this.e_panel.style.position = 'absolute';\r\n        this.e_panel.style.top = '-100000';\r\n        $.d.body.appendChild(this.e_panel);\r\n        func();\r\n        this.container.appendChild(this.e_panel);\r\n        this.e_panel.style.position = null;\r\n        this.e_panel.style.top = null;\r\n    }\r\n\r\n\r\n    ORIGcreate_node_element(node, parent_node) {\r\n        var view_data = null;\r\n        if ('view' in node._data) {\r\n            view_data = node._data.view;\r\n        } else {\r\n            view_data = {};\r\n            node._data.view = view_data;\r\n        }\r\n\r\n        var d = $.c('jmnode');\r\n        if (node.isroot) {\r\n            d.className = 'root';\r\n        } else {\r\n            var d_e = $.c('jmexpander');\r\n            $.t(d_e, '-');\r\n            d_e.setAttribute('nodeid', node.id);\r\n            d_e.style.visibility = 'hidden';\r\n            parent_node.appendChild(d_e);\r\n            view_data.expander = d_e;\r\n        }\r\n        if (!!node.topic) {\r\n            this.render_node(d, node);\r\n        }\r\n        d.setAttribute('nodeid', node.id);\r\n        d.style.visibility = 'hidden';\r\n        this._reset_node_custom_style(d, node.data);\r\n\r\n        parent_node.appendChild(d);\r\n        view_data.element = d;\r\n    }\r\n    create_node_element(node, parent_node) {\r\n        console.warn(\"create_node_element\", node, parent_node);\r\n        var view_data = null;\r\n        if ('view' in node._data) {\r\n            view_data = node._data.view;\r\n        } else {\r\n            view_data = {};\r\n            node._data.view = view_data;\r\n        }\r\n        const d = $.c('jmnode');\r\n        const dBg = $.c('div');\r\n        dBg.classList.add(\"jmnode-bg\");\r\n        d.appendChild(dBg);\r\n        const dOverF = $.c('div');\r\n        dOverF.classList.add(\"jmnode-overflow\");\r\n        d.appendChild(dOverF);\r\n        const dTxt = $.c(\"div\");\r\n        dTxt.classList.add(\"jmnode-text\");\r\n        dOverF.appendChild(dTxt);\r\n        if (node.isroot) {\r\n            d.className = 'root';\r\n        } else {\r\n            var d_e = $.c('jmexpander');\r\n            $.t(d_e, '-');\r\n            d_e.setAttribute('nodeid', node.id);\r\n            d_e.style.visibility = 'hidden';\r\n            parent_node.appendChild(d_e);\r\n            view_data.expander = d_e;\r\n            d.draggable = true;\r\n            switch (node.direction) {\r\n                case Direction.left:\r\n                    d.classList.add(\"left-side\");\r\n                    break;\r\n                case Direction.right:\r\n                    d.classList.add(\"right-side\");\r\n                    break;\r\n                default:\r\n                    debugger; // eslint-disable-line no-debugger\r\n            }\r\n        }\r\n        if (node.topic) {\r\n            if (this.opts.support_html) {\r\n                $.h(dTxt, node.topic);\r\n            } else {\r\n                $.t(dTxt, node.topic);\r\n            }\r\n        }\r\n        d.setAttribute('nodeid', node.id);\r\n        d.style.visibility = 'hidden';\r\n        this._reset_node_custom_style(d, node.data);\r\n        parent_node.appendChild(d);\r\n        view_data.element = d;\r\n    }\r\n\r\n\r\n\r\n    remove_node(node) {\r\n        if (this.selected_node != null && this.selected_node.id == node.id) {\r\n            this.selected_node = null;\r\n        }\r\n        if (this.editing_node != null && this.editing_node.id == node.id) {\r\n            node._data.view.element.removeChild(this.e_editor);\r\n            this.editing_node = null;\r\n        }\r\n        var children = node.children;\r\n        var i = children.length;\r\n        while (i--) {\r\n            this.remove_node(children[i]);\r\n        }\r\n        if (node._data.view) {\r\n            var element = node._data.view.element;\r\n            var expander = node._data.view.expander;\r\n            this.e_nodes.removeChild(element);\r\n            this.e_nodes.removeChild(expander);\r\n            node._data.view.element = null;\r\n            node._data.view.expander = null;\r\n        }\r\n    }\r\n\r\n\r\n    ORIGupdate_node(node) {\r\n        var view_data = node._data.view;\r\n        var element = view_data.element;\r\n        if (!!node.topic) {\r\n            this.render_node(element, node);\r\n        }\r\n        if (this.layout.is_visible(node)) {\r\n            view_data.width = element.clientWidth;\r\n            view_data.height = element.clientHeight;\r\n        } else {\r\n            let origin_style = element.getAttribute('style');\r\n            element.style = 'visibility: visible; left:0; top:0;';\r\n            view_data.width = element.clientWidth;\r\n            view_data.height = element.clientHeight;\r\n            element.style = origin_style;\r\n        }\r\n    }\r\n    update_node(node) {\r\n        var view_data = node._data.view;\r\n        var element = view_data.element;\r\n        element.classList.remove(\"right-side\");\r\n        element.classList.remove(\"left-side\");\r\n        switch (node.direction) {\r\n            case Direction.left:\r\n                element.classList.add(\"left-side\");\r\n                break;\r\n            case Direction.right:\r\n                element.classList.add(\"right-side\");\r\n                break;\r\n            default:\r\n                if (!node.isroot) {\r\n                    debugger; // eslint-disable-line no-debugger\r\n                }\r\n        }\r\n        if (node.topic) {\r\n            const dTxt = element.querySelector(\".jmnode-text\");\r\n            console.log({ dTxt });\r\n            if (!dTxt.classList.contains(\"jmnode-text\")) throw Error(\"Not div.jmnode-text\");\r\n            if (this.opts.support_html) {\r\n                $.h(dTxt, node.topic);\r\n            } else {\r\n                $.t(dTxt, node.topic);\r\n            }\r\n        }\r\n        console.log(\"view_provider update_node\");\r\n        if (this.layout.is_visible(node)) {\r\n            view_data.width = element.clientWidth;\r\n            view_data.height = element.clientHeight;\r\n        } else {\r\n            let origin_style = element.getAttribute('style');\r\n            element.style = 'visibility: visible; left:0; top:0;';\r\n            view_data.width = element.clientWidth;\r\n            view_data.height = element.clientHeight;\r\n            element.style = origin_style;\r\n        }\r\n    }\r\n\r\n\r\n\r\n    select_node(node) {\r\n        if (!!this.selected_node) {\r\n            var element = this.selected_node._data.view.element;\r\n            element.className = element.className.replace(/\\s*selected\\b/i, '');\r\n            this.restore_selected_node_custom_style(this.selected_node);\r\n        }\r\n        if (!!node) {\r\n            this.selected_node = node;\r\n            node._data.view.element.className += ' selected';\r\n            this.clear_selected_node_custom_style(node);\r\n        }\r\n    }\r\n    select_clear() {\r\n        this.select_node(null);\r\n    }\r\n    get_editing_node() {\r\n        return this.editing_node;\r\n    }\r\n    is_editing() {\r\n        return !!this.editing_node;\r\n    }\r\n    edit_node_begin(node) {\r\n        if (!node.topic) {\r\n            logger.warn(\"don't edit image nodes\");\r\n            return;\r\n        }\r\n        if (this.editing_node != null) {\r\n            this.edit_node_end();\r\n        }\r\n        this.editing_node = node;\r\n        var view_data = node._data.view;\r\n        var element = view_data.element;\r\n        var topic = node.topic;\r\n        var ncs = getComputedStyle(element);\r\n        this.e_editor.value = topic;\r\n        this.e_editor.style.width =\r\n            element.clientWidth -\r\n            parseInt(ncs.getPropertyValue('padding-left')) -\r\n            parseInt(ncs.getPropertyValue('padding-right')) +\r\n            'px';\r\n        element.innerHTML = '';\r\n        element.appendChild(this.e_editor);\r\n        element.style.zIndex = 5;\r\n        this.e_editor.focus();\r\n        this.e_editor.select();\r\n    }\r\n    edit_node_end() {\r\n        if (this.editing_node != null) {\r\n            var node = this.editing_node;\r\n            this.editing_node = null;\r\n            var view_data = node._data.view;\r\n            var element = view_data.element;\r\n            var topic = this.e_editor.value;\r\n            element.style.zIndex = 'auto';\r\n            element.removeChild(this.e_editor);\r\n            if (util.text.is_empty(topic) || node.topic === topic) {\r\n                this.render_node(element, node);\r\n            } else {\r\n                this.jm.update_node(node.id, topic);\r\n            }\r\n        }\r\n        this.e_panel.focus();\r\n    }\r\n    get_view_offset() {\r\n        var bounds = this.layout.bounds;\r\n        var _x = (this.size.w - bounds.e - bounds.w) / 2;\r\n        var _y = this.size.h / 2;\r\n        return { x: _x, y: _y };\r\n    }\r\n    resize() {\r\n        this.graph.set_size(1, 1);\r\n        this.e_nodes.style.width = '1px';\r\n        this.e_nodes.style.height = '1px';\r\n\r\n        this.expand_size();\r\n        this._show();\r\n    }\r\n    _show() {\r\n        this.graph.set_size(this.size.w, this.size.h);\r\n        this.e_nodes.style.width = this.size.w + 'px';\r\n        this.e_nodes.style.height = this.size.h + 'px';\r\n        this.show_nodes();\r\n        this.show_lines();\r\n        //this.layout.cache_valid = true;\r\n        this.jm.invoke_event_handle(EventType.resize, { data: [] });\r\n    }\r\n    zoom_in(e) {\r\n        return this.set_zoom(this.zoom_current + this.opts.zoom.step, e);\r\n    }\r\n    zoom_out(e) {\r\n        return this.set_zoom(this.zoom_current - this.opts.zoom.step, e);\r\n    }\r\n    set_zoom(zoom, e) {\r\n        if (zoom < this.opts.zoom.min || zoom > this.opts.zoom.max) {\r\n            return false;\r\n        }\r\n        let e_panel_rect = this.e_panel.getBoundingClientRect();\r\n        if (\r\n            zoom < 1 &&\r\n            zoom < this.zoom_current &&\r\n            this.size.w * zoom < e_panel_rect.width &&\r\n            this.size.h * zoom < e_panel_rect.height\r\n        ) {\r\n            return false;\r\n        }\r\n        let zoom_center = !!e\r\n            ? { x: e.x - e_panel_rect.x, y: e.y - e_panel_rect.y }\r\n            : { x: e_panel_rect.width / 2, y: e_panel_rect.height / 2 };\r\n        let panel_scroll_x =\r\n            ((this.e_panel.scrollLeft + zoom_center.x) * zoom) / this.zoom_current - zoom_center.x;\r\n        let panel_scroll_y =\r\n            ((this.e_panel.scrollTop + zoom_center.y) * zoom) / this.zoom_current - zoom_center.y;\r\n\r\n        this.zoom_current = zoom;\r\n        for (var i = 0; i < this.e_panel.children.length; i++) {\r\n            this.e_panel.children[i].style.zoom = zoom;\r\n        }\r\n        this._show();\r\n        this.e_panel.scrollLeft = panel_scroll_x;\r\n        this.e_panel.scrollTop = panel_scroll_y;\r\n        return true;\r\n    }\r\n    show(keep_center) {\r\n        logger.debug(`view.show: {keep_center: ${keep_center}}`);\r\n        this.expand_size();\r\n        this._show();\r\n        if (!!keep_center) {\r\n            this.center_node(this.jm.mind.root);\r\n        }\r\n    }\r\n    relayout() {\r\n        this.expand_size();\r\n        this._show();\r\n    }\r\n    save_location(node) {\r\n        var vd = node._data.view;\r\n        vd._saved_location = {\r\n            x: parseInt(vd.element.style.left) - this.e_panel.scrollLeft,\r\n            y: parseInt(vd.element.style.top) - this.e_panel.scrollTop,\r\n        };\r\n    }\r\n    restore_location(node) {\r\n        var vd = node._data.view;\r\n        this.e_panel.scrollLeft = parseInt(vd.element.style.left) - vd._saved_location.x;\r\n        this.e_panel.scrollTop = parseInt(vd.element.style.top) - vd._saved_location.y;\r\n    }\r\n    clear_nodes() {\r\n        var mind = this.jm.mind;\r\n        if (mind == null) {\r\n            return;\r\n        }\r\n        var nodes = mind.nodes;\r\n        var node = null;\r\n        for (var nodeid in nodes) {\r\n            node = nodes[nodeid];\r\n            node._data.view.element = null;\r\n            node._data.view.expander = null;\r\n        }\r\n        this.e_nodes.innerHTML = '';\r\n    }\r\n    show_nodes() {\r\n        var nodes = this.jm.mind.nodes;\r\n        var node = null;\r\n        var node_element = null;\r\n        var p = null;\r\n        var view_data = null;\r\n        var view_offset = this.get_view_offset();\r\n        for (var nodeid in nodes) {\r\n            node = nodes[nodeid];\r\n            view_data = node._data.view;\r\n            node_element = view_data.element;\r\n            if (!this.layout.is_visible(node)) {\r\n                node_element.style.display = 'none';\r\n                view_data.expander.style.display = 'none';\r\n                continue;\r\n            }\r\n            this.reset_node_custom_style(node);\r\n            p = this.layout.get_node_point(node);\r\n            view_data.abs_x = view_offset.x + p.x;\r\n            view_data.abs_y = view_offset.y + p.y;\r\n            node_element.style.left = view_offset.x + p.x + 'px';\r\n            node_element.style.top = view_offset.y + p.y + 'px';\r\n            node_element.style.display = '';\r\n            node_element.style.visibility = 'visible';\r\n            this._show_expander(node, view_offset);\r\n        }\r\n    }\r\n    _show_expander(node, view_offset) {\r\n        if (node.isroot) {\r\n            return;\r\n        }\r\n\r\n        var expander = node._data.view.expander;\r\n        if (node.children.length == 0) {\r\n            expander.style.display = 'none';\r\n            expander.style.visibility = 'hidden';\r\n            return;\r\n        }\r\n\r\n        let expander_text = this._get_expander_text(node);\r\n        $.t(expander, expander_text);\r\n\r\n        let p_expander = this.layout.get_expander_point(node);\r\n        expander.style.left = view_offset.x + p_expander.x + 'px';\r\n        expander.style.top = view_offset.y + p_expander.y + 'px';\r\n        expander.style.display = '';\r\n        expander.style.visibility = 'visible';\r\n    }\r\n\r\n    _get_expander_text(node) {\r\n        let style = !!this.opts.expander_style ? this.opts.expander_style.toLowerCase() : 'char';\r\n        if (style === 'number') {\r\n            return node.children.length > 99 ? '...' : node.children.length;\r\n        }\r\n        if (style === 'char') {\r\n            return node.expanded ? '-' : '+';\r\n        }\r\n    }\r\n\r\n    _default_node_render(ele, node) {\r\n        if (this.opts.support_html) {\r\n            $.h(ele, node.topic);\r\n        } else {\r\n            $.t(ele, node.topic);\r\n        }\r\n    }\r\n    _custom_node_render(ele, node) {\r\n        let rendered = this.opts.custom_node_render(this.jm, ele, node);\r\n        if (!rendered) {\r\n            this._default_node_render(ele, node);\r\n        }\r\n    }\r\n    reset_node_custom_style(node) {\r\n        this._reset_node_custom_style(node._data.view.element, node.data);\r\n    }\r\n    _reset_node_custom_style(node_element, node_data) {\r\n        if ('background-color' in node_data) {\r\n            node_element.style.backgroundColor = node_data['background-color'];\r\n        }\r\n        if ('foreground-color' in node_data) {\r\n            node_element.style.color = node_data['foreground-color'];\r\n        }\r\n        if ('width' in node_data) {\r\n            node_element.style.width = node_data['width'] + 'px';\r\n        }\r\n        if ('height' in node_data) {\r\n            node_element.style.height = node_data['height'] + 'px';\r\n        }\r\n        if ('font-size' in node_data) {\r\n            node_element.style.fontSize = node_data['font-size'] + 'px';\r\n        }\r\n        if ('font-weight' in node_data) {\r\n            node_element.style.fontWeight = node_data['font-weight'];\r\n        }\r\n        if ('font-style' in node_data) {\r\n            node_element.style.fontStyle = node_data['font-style'];\r\n        }\r\n        if ('background-image' in node_data) {\r\n            var backgroundImage = node_data['background-image'];\r\n            if (backgroundImage.startsWith('data') && node_data['width'] && node_data['height']) {\r\n                var img = new Image();\r\n\r\n                img.onload = function () {\r\n                    var c = $.c('canvas');\r\n                    c.width = node_element.clientWidth;\r\n                    c.height = node_element.clientHeight;\r\n                    var img = this;\r\n                    if (c.getContext) {\r\n                        var ctx = c.getContext('2d');\r\n                        ctx.drawImage(\r\n                            img,\r\n                            2,\r\n                            2,\r\n                            node_element.clientWidth,\r\n                            node_element.clientHeight\r\n                        );\r\n                        var scaledImageData = c.toDataURL();\r\n                        node_element.style.backgroundImage = 'url(' + scaledImageData + ')';\r\n                    }\r\n                };\r\n                img.src = backgroundImage;\r\n            } else {\r\n                node_element.style.backgroundImage = 'url(' + backgroundImage + ')';\r\n            }\r\n            node_element.style.backgroundSize = '99%';\r\n\r\n            if ('background-rotation' in node_data) {\r\n                node_element.style.transform =\r\n                    'rotate(' + node_data['background-rotation'] + 'deg)';\r\n            }\r\n        }\r\n    }\r\n    restore_selected_node_custom_style(node) {\r\n        var node_element = node._data.view.element;\r\n        var node_data = node.data;\r\n        if ('background-color' in node_data) {\r\n            node_element.style.backgroundColor = node_data['background-color'];\r\n        }\r\n        if ('foreground-color' in node_data) {\r\n            node_element.style.color = node_data['foreground-color'];\r\n        }\r\n    }\r\n    clear_selected_node_custom_style(node) {\r\n        var node_element = node._data.view.element;\r\n        node_element.style.backgroundColor = '';\r\n        node_element.style.color = '';\r\n    }\r\n    clear_lines() {\r\n        this.graph.clear();\r\n    }\r\n    show_lines() {\r\n        this.clear_lines();\r\n        var nodes = this.jm.mind.nodes;\r\n        var node = null;\r\n        var pin = null;\r\n        var pout = null;\r\n        var color = null;\r\n        var _offset = this.get_view_offset();\r\n        for (var nodeid in nodes) {\r\n            node = nodes[nodeid];\r\n            if (!!node.isroot) {\r\n                continue;\r\n            }\r\n            if (!this.layout.is_visible(node)) {\r\n                continue;\r\n            }\r\n            pin = this.layout.get_node_point_in(node);\r\n            pout = this.layout.get_node_point_out(node.parent);\r\n            color = node.data['leading-line-color'];\r\n            this.graph.draw_line(pout, pin, _offset, color);\r\n        }\r\n    }\r\n    // Drag the whole mind map with your mouse, when it's larger that the container\r\n    setup_canvas_draggable(enabled) {\r\n        this.opts.draggable = enabled;\r\n        if (!this._initialized) {\r\n            let dragging = false;\r\n            let x, y;\r\n            if (this.opts.hide_scrollbars_when_draggable) {\r\n                // Avoid scrollbars when mind map is larger than the container (e_panel = id jsmind-inner)\r\n                this.e_panel.style = 'overflow: hidden';\r\n            }\r\n            // Move the whole mind map with mouse moves, while button is down.\r\n            $.on(this.container, 'mousedown', eventDown => {\r\n                if (this.opts.draggable) {\r\n                    dragging = true;\r\n                    // Record current mouse position.\r\n                    x = eventDown.clientX;\r\n                    y = eventDown.clientY;\r\n                }\r\n            });\r\n            // Stop moving mind map once mouse button is released.\r\n            $.on(this.container, 'mouseup', () => {\r\n                dragging = false;\r\n            });\r\n            // Follow current mouse position and move mind map accordingly.\r\n            $.on(this.container, 'mousemove', eventMove => {\r\n                if (this.opts.draggable) {\r\n                    if (dragging) {\r\n                        this.e_panel.scrollBy(x - eventMove.clientX, y - eventMove.clientY);\r\n                        // Record new current position.\r\n                        x = eventMove.clientX;\r\n                        y = eventMove.clientY;\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    }\r\n    center_node(node) {\r\n        if (!this.layout.is_visible(node)) {\r\n            logger.warn('can not scroll to the node, because it is invisible');\r\n            return false;\r\n        }\r\n        let view_data = node._data.view;\r\n        let e_panel_rect = this.e_panel.getBoundingClientRect();\r\n        let node_center_point = {\r\n            x: view_data.abs_x + view_data.width / 2,\r\n            y: view_data.abs_y + view_data.height / 2,\r\n        };\r\n        this.e_panel.scrollTo(\r\n            node_center_point.x * this.zoom_current - e_panel_rect.width / 2,\r\n            node_center_point.y * this.zoom_current - e_panel_rect.height / 2\r\n        );\r\n        return true;\r\n    }\r\n\r\n    zoomIn(e) {\r\n        logger.warn('please use zoom_in instead');\r\n        return this.zoom_in(e);\r\n    }\r\n    zoomOut(e) {\r\n        logger.warn('please use zoom_out instead');\r\n        return this.zoom_out(e);\r\n    }\r\n    setZoom(zoom, e) {\r\n        logger.warn('please use set_zoom instead');\r\n        return this.set_zoom(zoom, e);\r\n    }\r\n}\r\n","/**\r\n * @license BSD\r\n * @copyright 2014-2023 hizzgdev@163.com\r\n *\r\n * Project Home:\r\n *   https://github.com/hizzgdev/jsmind/\r\n */\r\n\r\nimport { $ } from './jsmind.dom.js';\r\nimport { util } from './jsmind.util.js';\r\nimport { Direction } from './jsmind.common.js';\r\n\r\nexport class ShortcutProvider {\r\n    constructor(jm, options) {\r\n        this.jm = jm;\r\n        this.opts = options;\r\n        this.mapping = options.mapping;\r\n        this.handles = options.handles;\r\n        this._newid = null;\r\n        this._mapping = {};\r\n    }\r\n    init() {\r\n        $.on(this.jm.view.e_panel, 'keydown', this.handler.bind(this));\r\n\r\n        this.handles['addchild'] = this.handle_addchild;\r\n        this.handles['addbrother'] = this.handle_addbrother;\r\n        this.handles['editnode'] = this.handle_editnode;\r\n        this.handles['delnode'] = this.handle_delnode;\r\n        this.handles['toggle'] = this.handle_toggle;\r\n        this.handles['up'] = this.handle_up;\r\n        this.handles['down'] = this.handle_down;\r\n        this.handles['left'] = this.handle_left;\r\n        this.handles['right'] = this.handle_right;\r\n\r\n        for (var handle in this.mapping) {\r\n            if (!!this.mapping[handle] && handle in this.handles) {\r\n                let keys = this.mapping[handle];\r\n                if (!Array.isArray(keys)) {\r\n                    keys = [keys];\r\n                }\r\n                for (let key of keys) {\r\n                    this._mapping[key] = this.handles[handle];\r\n                }\r\n            }\r\n        }\r\n\r\n        if (typeof this.opts.id_generator === 'function') {\r\n            this._newid = this.opts.id_generator;\r\n        } else {\r\n            this._newid = util.uuid.newid;\r\n        }\r\n    }\r\n    enable_shortcut() {\r\n        this.opts.enable = true;\r\n    }\r\n    disable_shortcut() {\r\n        this.opts.enable = false;\r\n    }\r\n    handler(e) {\r\n        if (e.which == 9) {\r\n            e.preventDefault();\r\n        } //prevent tab to change focus in browser\r\n        if (this.jm.view.is_editing()) {\r\n            return;\r\n        }\r\n        var evt = e || event;\r\n        if (!this.opts.enable) {\r\n            return true;\r\n        }\r\n        var kc =\r\n            evt.keyCode +\r\n            (evt.metaKey << 13) +\r\n            (evt.ctrlKey << 12) +\r\n            (evt.altKey << 11) +\r\n            (evt.shiftKey << 10);\r\n        if (kc in this._mapping) {\r\n            this._mapping[kc].call(this, this.jm, e);\r\n        }\r\n    }\r\n    handle_addchild(_jm, e) {\r\n        var selected_node = _jm.get_selected_node();\r\n        if (!!selected_node) {\r\n            var node_id = this._newid();\r\n            var node = _jm.add_node(selected_node, node_id, 'New Node');\r\n            if (!!node) {\r\n                _jm.select_node(node_id);\r\n                _jm.begin_edit(node_id);\r\n            }\r\n        }\r\n    }\r\n    handle_addbrother(_jm, e) {\r\n        var selected_node = _jm.get_selected_node();\r\n        if (!!selected_node && !selected_node.isroot) {\r\n            var node_id = this._newid();\r\n            var node = _jm.insert_node_after(selected_node, node_id, 'New Node');\r\n            if (!!node) {\r\n                _jm.select_node(node_id);\r\n                _jm.begin_edit(node_id);\r\n            }\r\n        }\r\n    }\r\n    handle_editnode(_jm, e) {\r\n        var selected_node = _jm.get_selected_node();\r\n        if (!!selected_node) {\r\n            _jm.begin_edit(selected_node);\r\n        }\r\n    }\r\n    handle_delnode(_jm, e) {\r\n        var selected_node = _jm.get_selected_node();\r\n        if (!!selected_node && !selected_node.isroot) {\r\n            _jm.select_node(selected_node.parent);\r\n            _jm.remove_node(selected_node);\r\n        }\r\n    }\r\n    handle_toggle(_jm, e) {\r\n        var evt = e || event;\r\n        var selected_node = _jm.get_selected_node();\r\n        if (!!selected_node) {\r\n            _jm.toggle_node(selected_node.id);\r\n            evt.stopPropagation();\r\n            evt.preventDefault();\r\n        }\r\n    }\r\n    handle_up(_jm, e) {\r\n        var evt = e || event;\r\n        var selected_node = _jm.get_selected_node();\r\n        if (!!selected_node) {\r\n            var up_node = _jm.find_node_before(selected_node);\r\n            if (!up_node) {\r\n                var np = _jm.find_node_before(selected_node.parent);\r\n                if (!!np && np.children.length > 0) {\r\n                    up_node = np.children[np.children.length - 1];\r\n                }\r\n            }\r\n            if (!!up_node) {\r\n                _jm.select_node(up_node);\r\n            }\r\n            evt.stopPropagation();\r\n            evt.preventDefault();\r\n        }\r\n    }\r\n    handle_down(_jm, e) {\r\n        var evt = e || event;\r\n        var selected_node = _jm.get_selected_node();\r\n        if (!!selected_node) {\r\n            var down_node = _jm.find_node_after(selected_node);\r\n            if (!down_node) {\r\n                var np = _jm.find_node_after(selected_node.parent);\r\n                if (!!np && np.children.length > 0) {\r\n                    down_node = np.children[0];\r\n                }\r\n            }\r\n            if (!!down_node) {\r\n                _jm.select_node(down_node);\r\n            }\r\n            evt.stopPropagation();\r\n            evt.preventDefault();\r\n        }\r\n    }\r\n    handle_left(_jm, e) {\r\n        this._handle_direction(_jm, e, Direction.left);\r\n    }\r\n    handle_right(_jm, e) {\r\n        this._handle_direction(_jm, e, Direction.right);\r\n    }\r\n    _handle_direction(_jm, e, d) {\r\n        var evt = e || event;\r\n        var selected_node = _jm.get_selected_node();\r\n        var node = null;\r\n        if (!!selected_node) {\r\n            if (selected_node.isroot) {\r\n                var c = selected_node.children;\r\n                var children = [];\r\n                for (var i = 0; i < c.length; i++) {\r\n                    if (c[i].direction === d) {\r\n                        children.push(i);\r\n                    }\r\n                }\r\n                node = c[children[Math.floor((children.length - 1) / 2)]];\r\n            } else if (selected_node.direction === d) {\r\n                var children = selected_node.children;\r\n                var children_count = children.length;\r\n                if (children_count > 0) {\r\n                    node = children[Math.floor((children_count - 1) / 2)];\r\n                }\r\n            } else {\r\n                node = selected_node.parent;\r\n            }\r\n            if (!!node) {\r\n                _jm.select_node(node);\r\n            }\r\n            evt.stopPropagation();\r\n            evt.preventDefault();\r\n        }\r\n    }\r\n}\r\n","/**\r\n * @license BSD\r\n * @copyright 2014-2023 hizzgdev@163.com\r\n *\r\n * Project Home:\r\n *   https://github.com/hizzgdev/jsmind/\r\n */\r\n\r\nimport { $ } from './jsmind.dom.js';\r\n\r\nconst plugin_data = {\r\n    plugins: [],\r\n};\r\n\r\nexport function register(plugin) {\r\n    if (!(plugin instanceof Plugin)) {\r\n        throw new Error('can not register plugin, it is not an instance of Plugin');\r\n    }\r\n    if (plugin_data.plugins.map(p => p.name).includes(plugin.name)) {\r\n        throw new Error('can not register plugin ' + plugin.name + ': plugin name already exist');\r\n    }\r\n    plugin_data.plugins.push(plugin);\r\n}\r\n\r\nexport function apply(jm, options) {\r\n    $.w.setTimeout(function () {\r\n        _apply(jm, options);\r\n    }, 0);\r\n}\r\n\r\nfunction _apply(jm, options) {\r\n    plugin_data.plugins.forEach(p => p.fn_init(jm, options[p.name]));\r\n}\r\n\r\nexport class Plugin {\r\n    // function fn_init(jm, options){ }\r\n    constructor(name, fn_init) {\r\n        if (!name) {\r\n            throw new Error('plugin must has a name');\r\n        }\r\n        if (!fn_init || typeof fn_init !== 'function') {\r\n            throw new Error('plugin must has an init function');\r\n        }\r\n        this.name = name;\r\n        this.fn_init = fn_init;\r\n    }\r\n}\r\n","/**\r\n * @license BSD\r\n * @copyright 2014-2023 hizzgdev@163.com\r\n *\r\n * Project Home:\r\n *   https://github.com/hizzgdev/jsmind/\r\n */\r\n\r\nimport { __version__, logger, EventType, Direction, LogLevel } from './jsmind.common.js';\r\nimport { merge_option } from './jsmind.option.js';\r\nimport { Mind } from './jsmind.mind.js';\r\nimport { Node } from './jsmind.node.js';\r\nimport { DataProvider } from './jsmind.data_provider.js';\r\nimport { LayoutProvider } from './jsmind.layout_provider.js';\r\nimport { ViewProvider } from './jsmind.view_provider.js';\r\nimport { ShortcutProvider } from './jsmind.shortcut_provider.js';\r\nimport { Plugin, register as _register_plugin, apply as apply_plugins } from './jsmind.plugin.js';\r\nimport { format } from './jsmind.format.js';\r\nimport { $ } from './jsmind.dom.js';\r\nimport { util as _util } from './jsmind.util.js';\r\n\r\nexport default class jsMind {\r\n    static mind = Mind;\r\n    static node = Node;\r\n    static direction = Direction;\r\n    static event_type = EventType;\r\n    static $ = $;\r\n    static plugin = Plugin;\r\n    static register_plugin = _register_plugin;\r\n    static util = _util;\r\n\r\n    constructor(options) {\r\n        jsMind.current = this;\r\n        this.options = merge_option(options);\r\n        logger.level(LogLevel[this.options.log_level]);\r\n        this.version = __version__;\r\n        this.initialized = false;\r\n        this.mind = null;\r\n        this.event_handles = [];\r\n        this.init();\r\n    }\r\n\r\n    init() {\r\n        if (!!this.initialized) {\r\n            return;\r\n        }\r\n        this.initialized = true;\r\n        var opts_layout = {\r\n            mode: this.options.mode,\r\n            hspace: this.options.layout.hspace,\r\n            vspace: this.options.layout.vspace,\r\n            pspace: this.options.layout.pspace,\r\n            cousin_space: this.options.layout.cousin_space,\r\n        };\r\n        var opts_view = {\r\n            container: this.options.container,\r\n            support_html: this.options.support_html,\r\n            engine: this.options.view.engine,\r\n            enable_device_pixel_ratio: this.options.view.enable_device_pixel_ratio,\r\n            hmargin: this.options.view.hmargin,\r\n            vmargin: this.options.view.vmargin,\r\n            line_width: this.options.view.line_width,\r\n            line_color: this.options.view.line_color,\r\n            line_style: this.options.view.line_style,\r\n            custom_line_render: this.options.view.custom_line_render,\r\n            draggable: this.options.view.draggable,\r\n            hide_scrollbars_when_draggable: this.options.view.hide_scrollbars_when_draggable,\r\n            node_overflow: this.options.view.node_overflow,\r\n            zoom: this.options.view.zoom,\r\n            custom_node_render: this.options.view.custom_node_render,\r\n            expander_style: this.options.view.expander_style,\r\n        };\r\n        // create instance of function provider\r\n        this.data = new DataProvider(this);\r\n        this.layout = new LayoutProvider(this, opts_layout);\r\n        this.view = new ViewProvider(this, opts_view);\r\n        this.shortcut = new ShortcutProvider(this, this.options.shortcut);\r\n\r\n        this.data.init();\r\n        this.layout.init();\r\n        this.view.init();\r\n        this.shortcut.init();\r\n\r\n        this._event_bind();\r\n\r\n        apply_plugins(this, this.options.plugin);\r\n    }\r\n    get_editable() {\r\n        return this.options.editable;\r\n    }\r\n    enable_edit() {\r\n        this.options.editable = true;\r\n    }\r\n    disable_edit() {\r\n        this.options.editable = false;\r\n    }\r\n    get_view_draggable() {\r\n        return this.options.view.draggable;\r\n    }\r\n    enable_view_draggable() {\r\n        this.options.view.draggable = true;\r\n        this.view.setup_canvas_draggable(true);\r\n    }\r\n    disable_view_draggable() {\r\n        this.options.view.draggable = false;\r\n        this.view.setup_canvas_draggable(false);\r\n    }\r\n    // options are 'mousedown', 'click', 'dblclick', 'mousewheel'\r\n    enable_event_handle(event_handle) {\r\n        this.options.default_event_handle['enable_' + event_handle + '_handle'] = true;\r\n    }\r\n    // options are 'mousedown', 'click', 'dblclick', 'mousewheel'\r\n    disable_event_handle(event_handle) {\r\n        this.options.default_event_handle['enable_' + event_handle + '_handle'] = false;\r\n    }\r\n    set_theme(theme) {\r\n        var theme_old = this.options.theme;\r\n        this.options.theme = !!theme ? theme : null;\r\n        if (theme_old != this.options.theme) {\r\n            this.view.reset_theme();\r\n            this.view.reset_custom_style();\r\n        }\r\n    }\r\n    _event_bind() {\r\n        this.view.add_event(this, 'mousedown', this.mousedown_handle);\r\n        this.view.add_event(this, 'click', this.click_handle);\r\n        this.view.add_event(this, 'dblclick', this.dblclick_handle);\r\n        this.view.add_event(this, 'mousewheel', this.mousewheel_handle, true);\r\n    }\r\n    mousedown_handle(e) {\r\n        if (!this.options.default_event_handle['enable_mousedown_handle']) {\r\n            return;\r\n        }\r\n        var element = e.target || event.srcElement;\r\n        var node_id = this.view.get_binded_nodeid(element);\r\n        if (!!node_id) {\r\n            if (this.view.is_node(element)) {\r\n                this.select_node(node_id);\r\n            }\r\n        } else {\r\n            this.select_clear();\r\n        }\r\n    }\r\n    click_handle(e) {\r\n        if (!this.options.default_event_handle['enable_click_handle']) {\r\n            return;\r\n        }\r\n        var element = e.target || event.srcElement;\r\n        var is_expander = this.view.is_expander(element);\r\n        if (is_expander) {\r\n            var node_id = this.view.get_binded_nodeid(element);\r\n            if (!!node_id) {\r\n                this.toggle_node(node_id);\r\n            }\r\n        }\r\n    }\r\n    dblclick_handle(e) {\r\n        if (!this.options.default_event_handle['enable_dblclick_handle']) {\r\n            return;\r\n        }\r\n        if (this.get_editable()) {\r\n            var element = e.target || event.srcElement;\r\n            var is_node = this.view.is_node(element);\r\n            if (is_node) {\r\n                var node_id = this.view.get_binded_nodeid(element);\r\n                if (!!node_id) {\r\n                    this.begin_edit(node_id);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    // Use [Ctrl] + Mousewheel, to zoom in/out.\r\n    mousewheel_handle(e) {\r\n        // Test if mousewheel option is enabled and Ctrl key is pressed.\r\n        if (!this.options.default_event_handle['enable_mousewheel_handle'] || !e.ctrlKey) {\r\n            return;\r\n        }\r\n        var evt = e || event;\r\n        // Avoid default page scrolling behavior.\r\n        evt.preventDefault();\r\n\r\n        if (evt.deltaY < 0) {\r\n            this.view.zoom_in(evt); // wheel down\r\n        } else {\r\n            this.view.zoom_out(evt);\r\n        }\r\n    }\r\n    begin_edit(node) {\r\n        if (!Node.is_node(node)) {\r\n            var the_node = this.get_node(node);\r\n            if (!the_node) {\r\n                logger.error('the node[id=' + node + '] can not be found.');\r\n                return false;\r\n            } else {\r\n                return this.begin_edit(the_node);\r\n            }\r\n        }\r\n        if (this.get_editable()) {\r\n            this.view.edit_node_begin(node);\r\n        } else {\r\n            logger.error('fail, this mind map is not editable.');\r\n            return;\r\n        }\r\n    }\r\n    end_edit() {\r\n        this.view.edit_node_end();\r\n    }\r\n    toggle_node(node) {\r\n        if (!Node.is_node(node)) {\r\n            var the_node = this.get_node(node);\r\n            if (!the_node) {\r\n                logger.error('the node[id=' + node + '] can not be found.');\r\n                return;\r\n            } else {\r\n                return this.toggle_node(the_node);\r\n            }\r\n        }\r\n        if (node.isroot) {\r\n            return;\r\n        }\r\n        this.view.save_location(node);\r\n        this.layout.toggle_node(node);\r\n        this.view.relayout();\r\n        this.view.restore_location(node);\r\n    }\r\n    expand_node(node) {\r\n        if (!Node.is_node(node)) {\r\n            var the_node = this.get_node(node);\r\n            if (!the_node) {\r\n                logger.error('the node[id=' + node + '] can not be found.');\r\n                return;\r\n            } else {\r\n                return this.expand_node(the_node);\r\n            }\r\n        }\r\n        if (node.isroot) {\r\n            return;\r\n        }\r\n        this.view.save_location(node);\r\n        this.layout.expand_node(node);\r\n        this.view.relayout();\r\n        this.view.restore_location(node);\r\n    }\r\n    collapse_node(node) {\r\n        if (!Node.is_node(node)) {\r\n            var the_node = this.get_node(node);\r\n            if (!the_node) {\r\n                logger.error('the node[id=' + node + '] can not be found.');\r\n                return;\r\n            } else {\r\n                return this.collapse_node(the_node);\r\n            }\r\n        }\r\n        if (node.isroot) {\r\n            return;\r\n        }\r\n        this.view.save_location(node);\r\n        this.layout.collapse_node(node);\r\n        this.view.relayout();\r\n        this.view.restore_location(node);\r\n    }\r\n    expand_all() {\r\n        this.layout.expand_all();\r\n        this.view.relayout();\r\n    }\r\n    collapse_all() {\r\n        this.layout.collapse_all();\r\n        this.view.relayout();\r\n    }\r\n    expand_to_depth(depth) {\r\n        this.layout.expand_to_depth(depth);\r\n        this.view.relayout();\r\n    }\r\n    _reset() {\r\n        this.view.reset();\r\n        this.layout.reset();\r\n        this.data.reset();\r\n    }\r\n    _show(mind, skip_centering) {\r\n        var m = mind || format.node_array.example;\r\n        this.mind = this.data.load(m);\r\n        if (!this.mind) {\r\n            logger.error('data.load error');\r\n            return;\r\n        } else {\r\n            logger.debug('data.load ok');\r\n        }\r\n\r\n        this.view.load();\r\n        logger.debug('view.load ok');\r\n\r\n        this.layout.layout();\r\n        logger.debug('layout.layout ok');\r\n\r\n        this.view.show(!skip_centering);\r\n        logger.debug('view.show ok');\r\n\r\n        this.invoke_event_handle(EventType.show, { data: [mind] });\r\n    }\r\n    show(mind, skip_centering) {\r\n        this._reset();\r\n        this._show(mind, skip_centering);\r\n    }\r\n    get_meta() {\r\n        return {\r\n            name: this.mind.name,\r\n            author: this.mind.author,\r\n            version: this.mind.version,\r\n        };\r\n    }\r\n    get_data(data_format) {\r\n        var df = data_format || 'node_tree';\r\n        return this.data.get_data(df);\r\n    }\r\n    get_root() {\r\n        return this.mind.root;\r\n    }\r\n    get_node(node) {\r\n        if (Node.is_node(node)) {\r\n            return node;\r\n        }\r\n        return this.mind.get_node(node);\r\n    }\r\n    add_node(parent_node, node_id, topic, data, direction) {\r\n        if (this.get_editable()) {\r\n            var the_parent_node = this.get_node(parent_node);\r\n            var dir = Direction.of(direction);\r\n            if (dir === undefined) {\r\n                dir = this.layout.calculate_next_child_direction(the_parent_node);\r\n            }\r\n            var node = this.mind.add_node(the_parent_node, node_id, topic, data, dir);\r\n            if (!!node) {\r\n                this.view.add_node(node);\r\n                this.layout.layout();\r\n                this.view.show(false);\r\n                this.view.reset_node_custom_style(node);\r\n                this.expand_node(the_parent_node);\r\n                this.invoke_event_handle(EventType.edit, {\r\n                    evt: 'add_node',\r\n                    data: [the_parent_node.id, node_id, topic, data, dir],\r\n                    node: node_id,\r\n                });\r\n            }\r\n            return node;\r\n        } else {\r\n            logger.error('fail, this mind map is not editable');\r\n            return null;\r\n        }\r\n    }\r\n    insert_node_before(node_before, node_id, topic, data, direction) {\r\n        if (this.get_editable()) {\r\n            var the_node_before = this.get_node(node_before);\r\n            var dir = Direction.of(direction);\r\n            if (dir === undefined) {\r\n                dir = this.layout.calculate_next_child_direction(the_node_before.parent);\r\n            }\r\n            var node = this.mind.insert_node_before(the_node_before, node_id, topic, data, dir);\r\n            if (!!node) {\r\n                this.view.add_node(node);\r\n                this.layout.layout();\r\n                this.view.show(false);\r\n                this.invoke_event_handle(EventType.edit, {\r\n                    evt: 'insert_node_before',\r\n                    data: [the_node_before.id, node_id, topic, data, dir],\r\n                    node: node_id,\r\n                });\r\n            }\r\n            return node;\r\n        } else {\r\n            logger.error('fail, this mind map is not editable');\r\n            return null;\r\n        }\r\n    }\r\n    insert_node_after(node_after, node_id, topic, data, direction) {\r\n        if (this.get_editable()) {\r\n            var the_node_after = this.get_node(node_after);\r\n            var dir = Direction.of(direction);\r\n            if (dir === undefined) {\r\n                dir = this.layout.calculate_next_child_direction(the_node_after.parent);\r\n            }\r\n            var node = this.mind.insert_node_after(the_node_after, node_id, topic, data, dir);\r\n            if (!!node) {\r\n                this.view.add_node(node);\r\n                this.layout.layout();\r\n                this.view.show(false);\r\n                this.invoke_event_handle(EventType.edit, {\r\n                    evt: 'insert_node_after',\r\n                    data: [the_node_after.id, node_id, topic, data, dir],\r\n                    node: node_id,\r\n                });\r\n            }\r\n            return node;\r\n        } else {\r\n            logger.error('fail, this mind map is not editable');\r\n            return null;\r\n        }\r\n    }\r\n    remove_node(node) {\r\n        if (!Node.is_node(node)) {\r\n            var the_node = this.get_node(node);\r\n            if (!the_node) {\r\n                logger.error('the node[id=' + node + '] can not be found.');\r\n                return false;\r\n            } else {\r\n                return this.remove_node(the_node);\r\n            }\r\n        }\r\n        if (this.get_editable()) {\r\n            if (node.isroot) {\r\n                logger.error('fail, can not remove root node');\r\n                return false;\r\n            }\r\n            var node_id = node.id;\r\n            var parent_id = node.parent.id;\r\n            var parent_node = this.get_node(parent_id);\r\n            this.view.save_location(parent_node);\r\n            this.view.remove_node(node);\r\n            this.mind.remove_node(node);\r\n            this.layout.layout();\r\n            this.view.show(false);\r\n            this.view.restore_location(parent_node);\r\n            this.invoke_event_handle(EventType.edit, {\r\n                evt: 'remove_node',\r\n                data: [node_id],\r\n                node: parent_id,\r\n            });\r\n            return true;\r\n        } else {\r\n            logger.error('fail, this mind map is not editable');\r\n            return false;\r\n        }\r\n    }\r\n    update_node(node_id, topic) {\r\n        if (this.get_editable()) {\r\n            if (_util.text.is_empty(topic)) {\r\n                logger.warn('fail, topic can not be empty');\r\n                return;\r\n            }\r\n            var node = this.get_node(node_id);\r\n            if (!!node) {\r\n                if (node.topic === topic) {\r\n                    logger.info('nothing changed');\r\n                    this.view.update_node(node);\r\n                    return;\r\n                }\r\n                node.topic = topic;\r\n                this.view.update_node(node);\r\n                this.layout.layout();\r\n                this.view.show(false);\r\n                this.invoke_event_handle(EventType.edit, {\r\n                    evt: 'update_node',\r\n                    data: [node_id, topic],\r\n                    node: node_id,\r\n                });\r\n            }\r\n        } else {\r\n            logger.error('fail, this mind map is not editable');\r\n            return;\r\n        }\r\n    }\r\n    move_node(node_id, before_id, parent_id, direction) {\r\n        if (this.get_editable()) {\r\n            var node = this.get_node(node_id);\r\n            var updated_node = this.mind.move_node(node, before_id, parent_id, direction);\r\n            if (!!updated_node) {\r\n                this.view.update_node(updated_node);\r\n                this.layout.layout();\r\n                this.view.show(false);\r\n                this.invoke_event_handle(EventType.edit, {\r\n                    evt: 'move_node',\r\n                    data: [node_id, before_id, parent_id, direction],\r\n                    node: node_id,\r\n                });\r\n            }\r\n        } else {\r\n            logger.error('fail, this mind map is not editable');\r\n            return;\r\n        }\r\n    }\r\n    select_node(node) {\r\n        if (!Node.is_node(node)) {\r\n            var the_node = this.get_node(node);\r\n            if (!the_node) {\r\n                logger.error('the node[id=' + node + '] can not be found.');\r\n                return;\r\n            } else {\r\n                return this.select_node(the_node);\r\n            }\r\n        }\r\n        if (!this.layout.is_visible(node)) {\r\n            return;\r\n        }\r\n        this.mind.selected = node;\r\n        this.view.select_node(node);\r\n        this.invoke_event_handle(EventType.select, { evt: 'select_node', data: [], node: node.id });\r\n    }\r\n    get_selected_node() {\r\n        if (!!this.mind) {\r\n            return this.mind.selected;\r\n        } else {\r\n            return null;\r\n        }\r\n    }\r\n    select_clear() {\r\n        if (!!this.mind) {\r\n            this.mind.selected = null;\r\n            this.view.select_clear();\r\n        }\r\n    }\r\n    is_node_visible(node) {\r\n        return this.layout.is_visible(node);\r\n    }\r\n    scroll_node_to_center(node) {\r\n        if (!Node.is_node(node)) {\r\n            var the_node = this.get_node(node);\r\n            if (!the_node) {\r\n                logger.error('the node[id=' + node + '] can not be found.');\r\n            } else {\r\n                this.scroll_node_to_center(the_node);\r\n            }\r\n            return;\r\n        }\r\n        this.view.center_node(node);\r\n    }\r\n    find_node_before(node) {\r\n        if (!Node.is_node(node)) {\r\n            var the_node = this.get_node(node);\r\n            if (!the_node) {\r\n                logger.error('the node[id=' + node + '] can not be found.');\r\n                return;\r\n            } else {\r\n                return this.find_node_before(the_node);\r\n            }\r\n        }\r\n        if (node.isroot) {\r\n            return null;\r\n        }\r\n        var n = null;\r\n        if (node.parent.isroot) {\r\n            var c = node.parent.children;\r\n            var prev = null;\r\n            var ni = null;\r\n            for (var i = 0; i < c.length; i++) {\r\n                ni = c[i];\r\n                if (node.direction === ni.direction) {\r\n                    if (node.id === ni.id) {\r\n                        n = prev;\r\n                    }\r\n                    prev = ni;\r\n                }\r\n            }\r\n        } else {\r\n            n = this.mind.get_node_before(node);\r\n        }\r\n        return n;\r\n    }\r\n    find_node_after(node) {\r\n        if (!Node.is_node(node)) {\r\n            var the_node = this.get_node(node);\r\n            if (!the_node) {\r\n                logger.error('the node[id=' + node + '] can not be found.');\r\n                return;\r\n            } else {\r\n                return this.find_node_after(the_node);\r\n            }\r\n        }\r\n        if (node.isroot) {\r\n            return null;\r\n        }\r\n        var n = null;\r\n        if (node.parent.isroot) {\r\n            var c = node.parent.children;\r\n            var found = false;\r\n            var ni = null;\r\n            for (var i = 0; i < c.length; i++) {\r\n                ni = c[i];\r\n                if (node.direction === ni.direction) {\r\n                    if (found) {\r\n                        n = ni;\r\n                        break;\r\n                    }\r\n                    if (node.id === ni.id) {\r\n                        found = true;\r\n                    }\r\n                }\r\n            }\r\n        } else {\r\n            n = this.mind.get_node_after(node);\r\n        }\r\n        return n;\r\n    }\r\n    set_node_color(node_id, bg_color, fg_color) {\r\n        if (this.get_editable()) {\r\n            var node = this.mind.get_node(node_id);\r\n            if (!!node) {\r\n                if (!!bg_color) {\r\n                    node.data['background-color'] = bg_color;\r\n                }\r\n                if (!!fg_color) {\r\n                    node.data['foreground-color'] = fg_color;\r\n                }\r\n                this.view.reset_node_custom_style(node);\r\n            }\r\n        } else {\r\n            logger.error('fail, this mind map is not editable');\r\n            return null;\r\n        }\r\n    }\r\n    set_node_font_style(node_id, size, weight, style) {\r\n        if (this.get_editable()) {\r\n            var node = this.mind.get_node(node_id);\r\n            if (!!node) {\r\n                if (!!size) {\r\n                    node.data['font-size'] = size;\r\n                }\r\n                if (!!weight) {\r\n                    node.data['font-weight'] = weight;\r\n                }\r\n                if (!!style) {\r\n                    node.data['font-style'] = style;\r\n                }\r\n                this.view.reset_node_custom_style(node);\r\n                this.view.update_node(node);\r\n                this.layout.layout();\r\n                this.view.show(false);\r\n            }\r\n        } else {\r\n            logger.error('fail, this mind map is not editable');\r\n            return null;\r\n        }\r\n    }\r\n    set_node_background_image(node_id, image, width, height, rotation) {\r\n        if (this.get_editable()) {\r\n            var node = this.mind.get_node(node_id);\r\n            if (!!node) {\r\n                if (!!image) {\r\n                    node.data['background-image'] = image;\r\n                }\r\n                if (!!width) {\r\n                    node.data['width'] = width;\r\n                }\r\n                if (!!height) {\r\n                    node.data['height'] = height;\r\n                }\r\n                if (!!rotation) {\r\n                    node.data['background-rotation'] = rotation;\r\n                }\r\n                this.view.reset_node_custom_style(node);\r\n                this.view.update_node(node);\r\n                this.layout.layout();\r\n                this.view.show(false);\r\n            }\r\n        } else {\r\n            logger.error('fail, this mind map is not editable');\r\n            return null;\r\n        }\r\n    }\r\n    set_node_background_rotation(node_id, rotation) {\r\n        if (this.get_editable()) {\r\n            var node = this.mind.get_node(node_id);\r\n            if (!!node) {\r\n                if (!node.data['background-image']) {\r\n                    logger.error(\r\n                        'fail, only can change rotation angle of node with background image'\r\n                    );\r\n                    return null;\r\n                }\r\n                node.data['background-rotation'] = rotation;\r\n                this.view.reset_node_custom_style(node);\r\n                this.view.update_node(node);\r\n                this.layout.layout();\r\n                this.view.show(false);\r\n            }\r\n        } else {\r\n            logger.error('fail, this mind map is not editable');\r\n            return null;\r\n        }\r\n    }\r\n    resize() {\r\n        this.view.resize();\r\n    }\r\n    // callback(type ,data)\r\n    add_event_listener(callback) {\r\n        if (typeof callback === 'function') {\r\n            this.event_handles.push(callback);\r\n        }\r\n    }\r\n    clear_event_listener() {\r\n        this.event_handles = [];\r\n    }\r\n    invoke_event_handle(type, data) {\r\n        var j = this;\r\n        $.w.setTimeout(function () {\r\n            j._invoke_event_handle(type, data);\r\n        }, 0);\r\n    }\r\n    _invoke_event_handle(type, data) {\r\n        var l = this.event_handles.length;\r\n        for (var i = 0; i < l; i++) {\r\n            this.event_handles[i](type, data);\r\n        }\r\n    }\r\n\r\n    static show(options, mind) {\r\n        logger.warn(\r\n            '`jsMind.show(options, mind)` is deprecated, please use `jm = new jsMind(options); jm.show(mind);` instead'\r\n        );\r\n        var _jm = new jsMind(options);\r\n        _jm.show(mind);\r\n        return _jm;\r\n    }\r\n}\r\n"],"names":["__version__","String","prototype","startsWith","p","this","slice","length","Direction","left","center","right","of","dir","parseInt","toLowerCase","EventType","show","resize","edit","select","LogLevel","debug","info","warn","error","disable","_noop","logger","console","level","log","log_level","$","constructor","w","d","document","g","id","getElementById","c","tag","createElement","t","n","hasChildNodes","firstChild","nodeValue","appendChild","createTextNode","h","HTMLElement","innerHTML","i","el","nodeType","style","ownerDocument","on","e","addEventListener","attachEvent","window","util","file","read","file_data","fn_callback","reader","FileReader","onload","result","name","readAsText","save","type","blob","Blob","bb","BlobBuilder","MozBlobBuilder","WebKitBlobBuilder","MSBlobBuilder","append","getBlob","navigator","msSaveBlob","blob_url","URL","webkitURL","createObjectURL","anchor","visibility","href","download","body","evt","createEvent","initEvent","dispatchEvent","removeChild","location","json","json2string","JSON","stringify","string2json","json_str","parse","merge","b","a","o","Object","toString","call","uuid","newid","Date","getTime","Math","random","substring","text","is_empty","s","replace","default_options","container","editable","theme","mode","support_html","view","engine","enable_device_pixel_ratio","hmargin","vmargin","line_width","line_color","line_style","draggable","hide_scrollbars_when_draggable","node_overflow","zoom","min","max","step","custom_node_render","expander_style","layout","hspace","vspace","pspace","cousin_space","default_event_handle","enable_mousedown_handle","enable_click_handle","enable_dblclick_handle","enable_mousewheel_handle","shortcut","enable","handles","mapping","addchild","addbrother","editnode","delnode","toggle","up","down","plugin","Node","sId","iIndex","sTopic","oData","bIsRoot","oParent","eDirection","bExpanded","index","topic","data","isroot","parent","direction","expanded","children","_data","get_location","vd","x","abs_x","y","abs_y","get_size","width","height","static","node1","node2","i1","i2","parent_node","node","pid","Mind","author","version","root","selected","nodes","get_node","node_id","set_root","_put_node","add_node","idx","is_node","push","_update_index","insert_node_before","node_before","node_index","get_node_before","the_node","insert_node_after","node_after","get_node_after","move_node","before_id","parent_id","_move_node","_flow_node_direction","len","_move_node_internal","inherited","sibling","si","splice","origin_parent","remove_node","ci","node_parent","k","sort","compare","DEFAULT_META","format","node_tree","example","meta","get_mind","source","df","mind","_parse","get_data","_build_node","node_root","_extract_data","_extract_subnode","node_json","node_data","node_array","_array","reverse","root_node","_extract_root","root_json","extract_count","parentid","node_direction","sub_extract_count","_array_node","freemind","xml","xml_doc","_parse_xml","xml_root","_find_root","_load_node","xml_lines","_build_map","join","DOMParser","parseFromString","ActiveXObject","async","loadXML","childNodes","tagName","ns","xml_node","getAttribute","node_topic","node_folded","topic_children","topic_child","textContent","_load_attributes","node_expanded","node_position","child","attr","attr_data","pos","_escape","_line_regex","lines","split","_fill_nodes","node_path","line","match","substr","diff","pop","_build_lines","prefix","Array","DataProvider","jm","init","reset","load","mind_data","data_format","LayoutProvider","options","opts","isside","bounds","cache_valid","calculate_next_child_direction","children_len","r","layout_direction","layout_offset","_layout_direction_root","layout_data","children_count","side_index","_layout_direction_side","subnode","offset_x","offset_y","outer_height","left_nodes","right_nodes","unshift","outer_height_left","_layout_offset_subnodes","outer_height_right","total_height","nodes_count","node_outer_height","base_y","pd","set_visible","middle_height","_layout_offset_subnodes_height","get_node_offset","offset_cache","_offset_","offset_p","get_node_point","view_data","get_node_point_in","get_node_point_out","pout_cache","_pout_","get_expander_point","ex_p","ceil","get_min_size","pout","toggle_node","collapse_node","expand_node","part_layout","invoke_event_handle","expand_all","collapse_all","expand_to_depth","target_depth","curr_nodes","curr_depth","depth","root_layout_data","visible","is_expand","is_visible","SvgGraph","e_svg","setAttribute","size","line_drawing","straight","_line_to","curved","_bezier_to","init_line_render","createElementNS","custom_line_render","drawing","path","x1","y1","x2","y2","ctx","start_point","end_point","element","set_size","clear","draw_line","pin","offset","color","copy_to","dest_canvas_ctx","callback","img","Image","drawImage","src","btoa","XMLSerializer","serializeToString","CanvasGraph","e_canvas","className","canvas_ctx","getContext","dpr","device_pixel_ratio","scale","clearRect","strokeStyle","lineWidth","lineCap","beginPath","moveTo","bezierCurveTo","stroke","lineTo","ViewProvider","e_panel","e_nodes","selected_node","editing_node","graph","render_node","_custom_node_render","_default_node_render","zoom_current","devicePixelRatio","_initialized","e_editor","tabIndex","v","event","keyCode","edit_node_end","stopPropagation","offsetParent","IntersectionObserver","entities","observer","isIntersecting","unobserve","observe","add_event","obj","event_name","event_handle","capture_by_panel","target","get_binded_nodeid","parentElement","is_expander","clear_lines","clear_nodes","reset_theme","theme_name","reset_custom_style","nodeid","reset_node_custom_style","setup_canvas_draggable","init_nodes","expand_size","min_size","min_width","min_height","client_w","clientWidth","client_h","clientHeight","init_nodes_size","doc_frag","createDocumentFragment","create_node_element","run_in_c11y_mode_if_needed","func","position","top","ORIGcreate_node_element","d_e","expander","_reset_node_custom_style","dBg","classList","add","dOverF","dTxt","ORIGupdate_node","origin_style","update_node","remove","querySelector","contains","Error","select_node","restore_selected_node_custom_style","clear_selected_node_custom_style","select_clear","get_editing_node","is_editing","edit_node_begin","ncs","getComputedStyle","value","getPropertyValue","zIndex","focus","get_view_offset","_show","show_nodes","show_lines","zoom_in","set_zoom","zoom_out","e_panel_rect","getBoundingClientRect","zoom_center","panel_scroll_x","scrollLeft","panel_scroll_y","scrollTop","keep_center","center_node","relayout","save_location","_saved_location","restore_location","node_element","view_offset","display","_show_expander","expander_text","_get_expander_text","p_expander","ele","backgroundColor","fontSize","fontWeight","fontStyle","backgroundImage","scaledImageData","toDataURL","backgroundSize","transform","_offset","enabled","dragging","eventDown","clientX","clientY","eventMove","scrollBy","node_center_point","scrollTo","zoomIn","zoomOut","setZoom","ShortcutProvider","_newid","_mapping","handle","handler","bind","handle_addchild","handle_addbrother","handle_editnode","handle_delnode","handle_toggle","handle_up","handle_down","handle_left","handle_right","keys","isArray","key","id_generator","enable_shortcut","disable_shortcut","which","preventDefault","kc","metaKey","ctrlKey","altKey","shiftKey","_jm","get_selected_node","begin_edit","up_node","find_node_before","np","down_node","find_node_after","_handle_direction","floor","plugin_data","plugins","register","Plugin","map","includes","apply","setTimeout","forEach","fn_init","_apply","jsMind","_register_plugin","_util","current","merge_option","initialized","event_handles","opts_layout","opts_view","_event_bind","apply_plugins","get_editable","enable_edit","disable_edit","get_view_draggable","enable_view_draggable","disable_view_draggable","enable_event_handle","disable_event_handle","set_theme","theme_old","mousedown_handle","click_handle","dblclick_handle","mousewheel_handle","srcElement","deltaY","end_edit","_reset","skip_centering","m","get_meta","get_root","the_parent_node","undefined","the_node_before","the_node_after","updated_node","is_node_visible","scroll_node_to_center","prev","ni","found","set_node_color","bg_color","fg_color","set_node_font_style","weight","set_node_background_image","image","rotation","set_node_background_rotation","add_event_listener","clear_event_listener","j","_invoke_event_handle","l"],"mappings":"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"}